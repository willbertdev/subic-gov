/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function(Drupal,drupalSettings){Drupal.behaviors.activeLinks={attach(context){const path=drupalSettings.path;const queryString=JSON.stringify(path.currentQuery);const querySelector=path.currentQuery?`[data-drupal-link-query='${queryString}']`:':not([data-drupal-link-query])';const originalSelectors=[`[data-drupal-link-system-path="${path.currentPath}"]`];let selectors;if(path.isFront)originalSelectors.push('[data-drupal-link-system-path="<front>"]');selectors=[].concat(originalSelectors.map((selector)=>`${selector}:not([hreflang])`),originalSelectors.map((selector)=>`${selector}[hreflang="${path.currentLanguage}"]`));selectors=selectors.map((current)=>current+querySelector);const activeLinks=context.querySelectorAll(selectors.join(','));const il=activeLinks.length;for(let i=0;i<il;i++){activeLinks[i].classList.add('is-active');activeLinks[i].setAttribute('aria-current','page');}},detach(context,settings,trigger){if(trigger==='unload'){const activeLinks=context.querySelectorAll('[data-drupal-link-system-path].is-active');const il=activeLinks.length;for(let i=0;i<il;i++){activeLinks[i].classList.remove('is-active');activeLinks[i].removeAttribute('aria-current');}}}};})(Drupal,drupalSettings);;
(function($,Drupal){'use strict';var imce=window.imce={conf:{},local:{},events:{},shortcuts:{fm:{},tree:{},content:{}},toolbarButtons:{},tree:{},selection:[],messageQueue:[],sorters:{}};$(function(){var settings=window.drupalSettings;var conf=settings&&settings.imce;var body=document.body;if(conf&&!imce.activeFolder&&$(body).hasClass('imce-page')){if(!conf.ajax_url)conf.ajax_url=Drupal.url(settings.path.currentPath);imce.init(conf,body);}});imce.init=function(conf,parentEl){conf=$.extend(imce.conf,conf);if(!conf.ajax_url||!conf.folders||!conf.root_url)return;imce.parentEl=parentEl;try{$.extend(imce.local,JSON.parse(localStorage.getItem('imce.local')));}catch(err){imce.delayError(err);}imce.trigger('preinit');imce.checkIntegration();imce.initUI();imce.initTree();imce.addShortcut('ENTER',imce.eTreeEnter,'tree');imce.addShortcut('UP',imce.eTreeUp,'tree');imce.addShortcut('DOWN',imce.eTreeDown,'tree');imce.addShortcut('LEFT',imce.eTreeLR,'tree');imce.addShortcut('RIGHT',imce.eTreeLR,'tree');imce.addShortcut('ENTER',imce.eContentEnter,'content');imce.addShortcut('UP',imce.eContentArrow,'content');imce.addShortcut('DOWN',imce.eContentArrow,'content');imce.addShortcut('LEFT',imce.eContentArrow,'content');imce.addShortcut('RIGHT',imce.eContentArrow,'content');imce.addShortcut('Ctrl+A',imce.eContentCtrlA,'content');imce.addTbb('refresh',{title:Drupal.t('Refresh'),permission:'browse_files|browse_subfolders',handler:imce.eFmRefresh,shortcut:'F5',icon:'refresh'});imce.bind('activateFolder',imce.defaultActivateFolder);imce.trigger('init');imce.createSendtoTbb();parentEl.appendChild(imce.fmEl);$(window).on('beforeunload',imce.eWinBeforeunload).on('resize',imce.eWinResize);imce.eWinResize();imce.contentEl.focus();imce.ajaxProcessMessages(conf);var path=conf.active_path;var Folder=path&&imce.addFolder(path);if(!Folder)for(path in conf.folders)if(Folder=imce.getFolder(path))break;if(Folder)Folder.open();imce.trigger('postinit');};imce.initUI=function(){var el=imce.fmEl;var createEl=imce.createEl;if(el)return el;el=imce.fmEl=createEl('<div id="imce-fm"></div>');el.onkeydown=imce.eFmKeydown;el.tabIndex=0;el.appendChild(imce.toolbarEl=createEl('<div id="imce-toolbar" aria-label="Operations" role="toolbar"></div>'));el.appendChild(imce.bodyEl=createEl('<div id="imce-body"></div>'));el=imce.treeEl=createEl('<div id="imce-tree"></div>');el.onkeydown=imce.eTreeKeydown;el.onmousedown=imce.eTreeMousedown;el.ontouchstart=imce.eTreeTouchstart;el.tabIndex=0;imce.bodyEl.appendChild(el);el=imce.treeResizerEl=createEl('<div id="imce-tree-resizer"></div>');el.onmousedown=imce.eTreeResizerMousedown;el.ontouchstart=imce.eTreeResizerTouchstart;imce.bodyEl.appendChild(el);el=imce.contentEl=createEl('<div id="imce-content"></div>');if(imce.conf.thumbnail_grid_style)el.className='thumbnail-grid';el.onmousedown=imce.eContentMousedown;el.ontouchstart=imce.eContentTouchstart;el.onkeydown=imce.eContentKeydown;el.onscroll=imce.eContentScroll;el.tabIndex=0;imce.bodyEl.appendChild(el);el=imce.contentHeaderEl=imce.createEl('<div class="imce-content-header"><div class="imce-item"><div class="imce-item-date" data-sort="date">'+Drupal.t('Date')+'</div><div class="imce-item-height" data-sort="height">'+Drupal.t('Height')+'</div><div class="imce-item-width" data-sort="width">'+Drupal.t('Width')+'</div><div class="imce-item-size" data-sort="size">'+Drupal.t('Size')+'</div><div class="imce-item-icon imce-ficon" data-sort="ext"></div><div class="imce-item-name" data-sort="name">'+Drupal.t('Name')+'</div></div></div>');el.onclick=imce.eContentHeaderClick;imce.contentEl.appendChild(el);el=imce.contentStatusEl=imce.createEl('<div class="imce-content-status"></div>');imce.contentEl.appendChild(el);el=imce.bodyResizerEl=createEl('<div id="imce-body-resizer"></div>');el.onmousedown=imce.eBodyResizerMousedown;el.ontouchstart=imce.eBodyResizerTouchstart;imce.fmEl.appendChild(el);imce.fmEl.appendChild(imce.previewEl=createEl('<div id="imce-preview"></div>'));return el;};imce.initTree=function(){var path;var folders=imce.getConf('folders');var scheme=imce.getConf('scheme');var root=new imce.Folder(scheme?scheme+'://':'<'+Drupal.t('root')+'>');root.setPath('.');root.branchEl.className+=' root';imce.treeEl.appendChild(root.branchEl);var paths=[];for(path in folders)if(imce.owns(folders,path))paths.push(path);paths.sort();for(var i=0;path=paths[i];i++)imce.addFolder(path,folders[path]);};imce.getFolder=function(path){if(imce.owns(imce.tree,path))return imce.tree[path];};imce.getItem=function(path){var Folder;var parts=imce.splitPath(path);if(parts)if(Folder=imce.getFolder(parts[0]))return Folder.getItem(parts[1]);};imce.addFolder=function(path,conf){var parts;var parent;var Folder=imce.getFolder(path);if(Folder){if(conf)Folder.setConf(conf);return Folder;}if(parts=imce.splitPath(path))if(parent=imce.addFolder(parts[0])){Folder=new imce.Folder(parts[1],conf);parent.appendItem(Folder);return Folder;}};imce.addTbb=function(id,opt){return imce.getTbb(id)||new imce.Tbb(id,opt);};imce.getTbb=function(id){return imce.toolbarButtons[id];};imce.getConf=function(name,defaultValue){var value;var conf=imce.conf;if(!name)return conf;value=conf[name];return value==null?defaultValue:value;};imce.getSelection=function(){return imce.selection.slice(0);};imce.countSelection=function(){return this.selection.length;};imce.groupSelection=function(){return imce.groupItems(imce.selection);};imce.selectAll=function(){var Folder=imce.activeFolder;if(Folder)Folder.selectAll();};imce.deselectAll=function(){var i;var arr=imce.getSelection();for(i in arr)if(imce.owns(arr,i))arr[i].deselect();};imce.getLastSelected=function(){var arr=imce.selection;var len=arr.length;if(len)return arr[len-1];};imce.selectItem=function(Item){if(!Item.selected){var arr=imce.selection;var oldlen=arr.length;arr.push(Item);Item.setState('selected');if(oldlen<2)imce.updatePreview();}};imce.deselectItem=function(Item){if(Item.selected){var arr=imce.selection;var i=$.inArray(Item,arr);Item.unsetState('selected');if(i!==-1){arr.splice(i,1);if(arr.length<2)imce.updatePreview();}}};imce.loadItemUuids=function(items,callback){var i;var Item;var missing=[];var loaded=[];for(i in items){Item=items[i];if(Item&&Item.isFile)if(Item.uuid)loaded.push(Item);else missing.push(Item);}if(!missing.length){if(callback)callback(loaded);return loaded;}return imce.ajaxItems('uuid',missing,{customComplete:function(xhr,status){var path;var Item;var response=this.response;if(response&&response.uuids)for(path in response.uuids)if(Item=imce.getItem(path)){Item.uuid=response.uuids[path];loaded.push(Item);}if(callback)callback(loaded);}});};imce.itemsHtml=function(items,type,innerHtml,separator){const lines=[];const isImg=type==='image';for(const File of items)if(isImg&&File.isImageSource())lines.push('<img src="'+File.getUrl()+'"'+(File.width?' width="'+File.width+'"':'')+(File.height?' height="'+File.height+'"':'')+' data-entity-type="file" data-entity-uuid="'+(File.uuid||'')+'" alt="" />');else{const text=(!lines.length&&innerHtml)||File.formatName();lines.push('<a href="'+File.getUrl()+'">'+text+'</a>');}return lines.join(separator==null?'<br />':separator);};imce.checkIntegration=function(){var query=imce.getQuery();var handler;var urlField;var parentWin=window.opener||window.parent;if(imce.parentWin=parentWin){if(handler=imce.resolveHandler(query.sendto,parentWin))imce.sendtoHandler=handler;else{if(urlField=query.urlField)if(urlField=parentWin.document.getElementById(urlField))imce.sendtoHandler=function(Item,win){try{imce.parentWin.focus();(imce.parentWin.jQuery||$)(urlField).val(Item.getUrl()).trigger('blur').trigger('change').trigger('focus');}catch(err){imce.delayError(err);}win.close();};}if(handler=imce.resolveHandler(query.oninit,parentWin))imce.bind('init',handler);if(imce.sendtoHandler&&query.type)imce.sendtoType=query.type;}};imce.createSendtoTbb=function(title,desc){if(imce.sendtoHandler&&!imce.getTbb('sendto'))return imce.addTbb('sendto',{title:title||Drupal.t('Select'),tooltip:desc||Drupal.t('Use the selected file.'),handler:function(){imce.runSendtoHandler();},icon:'check'});};imce.runSendtoHandler=function(items){var handler=imce.sendtoHandler;if(handler){var Item;var imgType=imce.sendtoType==='image';items=items||imce.getSelection();for(var i in items)if(imce.owns(items,i)){Item=items[i];if(imgType?Item.isImageSource():Item.isFile)return handler(Item,window);}}};imce.defaultActivateFolder=function(Folder,oldFolder){var i;var j;var Tbb;var perm;var disabled;var buttons=imce.toolbarButtons;for(i in buttons){if(!imce.owns(buttons,i))continue;Tbb=buttons[i];if(perm=Tbb.permission){perm=perm.split('|');disabled=true;for(j in perm)if(Folder.getPermission(perm[j])){disabled=false;break;}Tbb.setDisabled(disabled);}}};imce.updateHeader=function(){var newsort=imce.activeFolder.activeSort;var oldsort=imce.activeSort||{};var el=imce.contentHeaderEl;if(newsort&&(newsort.key!==oldsort.key||newsort.desc!==oldsort.desc)){if(oldsort.key)$('[data-sort="'+oldsort.key+'"]',el).removeClass('sorted '+(oldsort.desc?'desc':'asc'));$('[data-sort="'+newsort.key+'"]',el).addClass('sorted '+(newsort.desc?'desc':'asc'));imce.activeSort=newsort;}};imce.updatePreview=function(){clearTimeout(imce.previewTimer);imce.previewTimer=setTimeout(imce.doUpdatePreview,100);};imce.doUpdatePreview=function(){imce.previewItem(imce.countSelection()===1?imce.getLastSelected():null);};imce.previewItem=function(Item){var currentItem=imce.previewingItem;if(imce.previewingItem=Item){$(imce.previewEl).html(Item.createPreviewEl());imce.trigger('previewItem',Item);}else{if(currentItem)imce.previewEl.innerHTML='';}};imce.updateStatus=function(){clearTimeout(imce.statusTimer);imce.statusTimer=setTimeout(imce.doUpdateStatus,100);};imce.doUpdateStatus=function(){var Folder=imce.activeFolder;if(Folder)$(imce.contentStatusEl).html(Folder.formatStatus());};imce.getNameFilter=function(){var filters=imce.getConf('name_filters',[]);if(!imce.getConf('allow_dot_files'))filters.push('^\\.|\\.$');return filters.length?new RegExp(filters.join('|')):false;};imce.groupItems=function(items){var i;var Item;var path;var selected;var key;var names;var group={};for(i in items){if(!imce.owns(items,i))continue;Item=items[i];path=Item.parent.getPath();selected=group[path]=imce.owns(group,path)?group[path]:{};key=Item.isFolder?'subfolders':'files';names=selected[key]=selected[key]||{};names[Item.name]=Item;}return group;};imce.validatePermissions=function(items,filePerm,subfolderPerm){var path;var Folder;var selected;var groups=imce.groupItems(items);for(path in groups){if(!imce.owns(groups,path))continue;Folder=imce.getFolder(path);selected=groups[path];if(selected.files&&(filePerm==null||!Folder.getPermission(filePerm)))return false;if(selected.subfolders&&(subfolderPerm==null||!Folder.getPermission(subfolderPerm)))return false;}return true;};imce.validatePredefinedPath=function(items){var i;var Item;var Folder;for(i in items){if(!imce.owns(items,i))continue;Item=items[i];if(Item.isFolder)if(Folder=Item.hasPredefinedPath()){imce.setMessage(Drupal.t('%path is a predefined path and can not be modified.',{'%path':Folder.getPath()}));return false;}}return true;};imce.validateCount=function(items){if(!items.length){imce.setMessage(Drupal.t('Please select a file.'));return false;}return true;};imce.validateExtensions=function(items,exts){for(var i in items)if(imce.owns(items,i)&&!imce.validateExtension(items[i].ext,exts))return false;return true;};imce.validateExtension=function(ext,exts){if(!ext||$.inArray(ext.toLowerCase(),exts.toLowerCase().split(/[\s,]+/))===-1){imce.setMessage(Drupal.t('Only files with the following extensions are allowed: %files-allowed.',{'%files-allowed':exts}));return false;}return true;};imce.validateFileName=function(name){if(!name||name==='.'||name==='..'||!name.length||name.length>240)return false;var regex=imce.getNameFilter();if(regex&&regex.test(name)){imce.setMessage(Drupal.t('%filename is not allowed.',{'%filename':name}));return false;}if(/^\s|\s$|[\/\\:\*\?\x22<>\|\x00-\x1F]/.test(name)){imce.setMessage(Drupal.t('%filename contains invalid characters. Use only alphanumeric characters for better portability.',{'%filename':name}));return false;}return true;};imce.validateDimensions=function(items,width,height){if(width<1||height<1)return false;var maxwidth=imce.getConf('maxwidth');var maxheight=imce.getConf('maxheight');if(maxwidth&&width>maxwidth||maxheight&&height>maxheight){imce.setMessage(Drupal.t('Image dimensions must be smaller than %dimensions pixels.',{'%dimensions':maxwidth+'x'+maxwidth}));return false;}return true;};imce.validateImageTypes=function(items){var Item=imce.getFirstItem(items,'width',false);if(Item){imce.setMessage(Drupal.t('%name is not an image.',{'%name':Item.name}));return false;}return true;};imce.eFmKeydown=function(event){return imce.eFireShortcut.call(this,event);};imce.eFmRefresh=function(){imce.activeFolder.load();};imce.eTreeMousedown=function(event){this.focus();};imce.eTreeTouchstart=function(event){this.focus();};imce.eTreeKeydown=function(event){return imce.eFireShortcut.call(this,event,'tree');};imce.eTreeEnter=function(){imce.activeFolder.open();};imce.eTreeUp=function(e){var Folder=imce.activeFolder;var prvEl;var prvFolder;if(prvEl=Folder.branchEl.previousSibling){if(prvFolder=prvEl.Folder)while(prvFolder.expanded)if(prvEl=prvFolder.subtreeEl.lastChild)prvFolder=prvEl.Folder;}else prvFolder=Folder.parent;if(prvFolder){prvFolder.activate();imce.scrollToEl(prvFolder.branchEl,imce.treeEl);}};imce.eTreeDown=function(e){var Folder=imce.activeFolder;var nextEl;var nextFolder;if(Folder.expanded&&(nextEl=Folder.subtreeEl.firstChild))nextFolder=nextEl.Folder;else{do if(nextEl=Folder.branchEl.nextSibling){nextFolder=nextEl.Folder;break;}while(Folder=Folder.parent);}if(nextFolder){nextFolder.activate();imce.scrollToEl(nextFolder.branchEl,imce.treeEl);}};imce.eTreeLR=function(e){var Folder=imce.activeFolder;if(e.keyCode===39^Folder.expanded)$(Folder.branchToggleEl).trigger('click');};imce.eTreeResizerMousedown=function(event){return imce.eTreeResizerDown.call(this,imce.eFix(event));};imce.eTreeResizerTouchstart=function(event){return imce.eCommonTouchstart(event,imce.eTreeResizerDown,this);};imce.eTreeResizerDown=function(e,isTouch){this.startX=e.pageX;this.startW=$(imce.treeEl).width();this.maxW=this.startW+$(imce.contentEl).width();imce.bindDragDrop(imce.eTreeResizerDrag,null,null,isTouch);return false;};imce.eTreeResizerDrag=function(e){var el=imce.treeResizerEl;$(imce.treeEl).width(Math.min(el.maxW,Math.max(el.startW+e.pageX-el.startX,0)));e.preventDefault();};imce.eContentMousedown=function(event){this.focus();};imce.eContentTouchstart=function(event){this.focus();};imce.eContentKeydown=function(event){return imce.eFireShortcut.call(this,event,'content');};imce.eContentScroll=function(event){imce.updateContentPositions();setTimeout(imce.updateContentPositions);};imce.eContentHeaderClick=function(event){var key;var e=imce.eFix(event);var Folder=imce.activeFolder;var sort=Folder.activeSort||{};if(key=e.target.getAttribute('data-sort'))Folder.sortItems(key,key===sort.key?!sort.desc:sort.desc);};imce.updateContentPositions=function(){var top=imce.contentEl.scrollTop;imce.contentHeaderEl.style.top=top+'px';imce.contentStatusEl.style.bottom=-top+'px';};imce.eContentEnter=function(e){var Item=imce.getLastSelected();if(Item)Item.dblClick();};imce.eContentCtrlA=function(e){imce.selectAll();};imce.eContentArrow=function(e){var Item;var i=0;var Folder=imce.activeFolder;var key=e.keyCode;if(Item=imce.getLastSelected())i=Folder.indexOf(Item)+(key%2?key-38:imce.countElPerRow(Item.el)*(key-39));if(Item=Folder.getItemAt(i)){Item.click(e);Item.scrollIntoView();}};imce.eBodyResizerMousedown=function(event){return imce.eBodyResizerDown.call(this,imce.eFix(event));};imce.eBodyResizerTouchstart=function(event){return imce.eCommonTouchstart(event,imce.eBodyResizerDown,this);};imce.eBodyResizerDown=function(e,isTouch){this.startY=e.pageY;this.startH=$(imce.bodyEl).height();this.maxH=this.startH+$(imce.previewEl).height();imce.bindDragDrop(imce.eBodyResizerDrag,null,null,isTouch);return false;};imce.eBodyResizerDrag=function(e){var el=imce.bodyResizerEl;var bodyH=Math.min(Math.max(el.startH+e.pageY-el.startY,0),el.maxH);$(imce.bodyEl).height(bodyH);$(imce.previewEl).height(el.maxH-bodyH);e.preventDefault();};imce.eWinBeforeunload=function(e){var data={};if(data.activeSort=imce.activeSort){imce.trigger('storeLocalData',data);try{localStorage.setItem('imce.local',JSON.stringify(data));}catch(err){imce.delayError(err);}}};imce.eWinResize=function(e){var pdiff;var diff=imce.getWindowSize().height-imce.fmEl.offsetHeight;if(diff){var $bodyEl=$(imce.bodyEl);var $prvEl=$(imce.previewEl);if($prvEl[0].offsetHeight){pdiff=parseInt(diff/2);diff-=pdiff;$prvEl.height($prvEl.height()+pdiff);}$bodyEl.height($bodyEl.height()+diff);}};imce.bind=function(type,handler){var events=imce.events;var handlers=events[type];if(!handlers)handlers=events[type]={};handlers[''+handler]=handler;};imce.unbind=function(type,handler){var events=imce.events;var handlers=events[type];if(handlers)if(1 in arguments)delete handlers[''+handler];else delete events[type];};imce.trigger=function(type){var i;var handler;var handlers=imce.events[type];var ret=[];if(handlers)for(i in handlers)if(handler=handlers[i])if(handler.apply)ret.push(handler.apply(imce,Array.prototype.slice.call(arguments,1)));return ret;};imce.addShortcut=function(shortcut,handler,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))shortcuts[shortcut.toUpperCase()]=handler;};imce.getShortcut=function(shortcut,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))return shortcuts[shortcut.toUpperCase()];};imce.removeShortcut=function(shortcut,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))delete shortcuts[shortcut.toUpperCase()];};imce.fireShortcut=function(shortcut,area){var handler=imce.getShortcut(shortcut,area);if(handler){if(handler.click){handler.click();return true;}if(handler.apply)return handler.apply(this,Array.prototype.slice.call(arguments,2))!==false;}};imce.getAreaShortcuts=function(area){if(!area)area='fm';return imce.shortcuts[area];};imce.eBuildShortcut=function(e){var symbol;var key=e.keyCode;var shortcut='';if(key&&(symbol=imce.getKeySymbols(key))){if(e.ctrlKey)shortcut+='CTRL+';if(e.altKey)shortcut+='ALT+';if(e.shiftKey)shortcut+='SHIFT+';shortcut+=symbol;}return shortcut;};imce.eFireShortcut=function(event,area){var e=event||window.event;var shortcut=imce.eBuildShortcut(e);if(shortcut){e=$.event.fix(e);if(imce.fireShortcut.call(this,shortcut,area,e)){e.stopPropagation();return false;}}};imce.getKeySymbols=function(key){var i;var symbols=imce.keySymbols;if(!symbols){symbols=imce.keySymbols={8:'BACKSPACE',9:'TAB',13:'ENTER',27:'ESC',32:'SPACE',37:'LEFT',38:'UP',39:'RIGHT',40:'DOWN',46:'DEL'};for(i=0;i<10;i++)symbols[48+i]=''+i;for(i=65;i<91;i++)symbols[i]=String.fromCharCode(i);for(i=1;i<13;i++)symbols[111+i]='F'+i;}return (0 in arguments)?symbols[key]:symbols;};imce.ajax=function(jsop,opt){return $.ajax(imce.ajaxPrepare(jsop,opt));};imce.ajaxPrepare=function(jsop,opt){var path;var Folder=opt&&opt.activeFolder!=null?opt.activeFolder:imce.activeFolder;var data={jsop,token:imce.getConf('token')};if(Folder)if(path=Folder.getPath())data.active_path=path;return $.extend(true,imce.ajaxDefaults(),{data,activeFolder:Folder},opt);};imce.ajaxDefaults=function(){return {url:imce.getConf('ajax_url'),type:'POST',dataType:'json',beforeSend:imce.ajaxBeforeSend,success:imce.ajaxSuccess,error:imce.ajaxError,complete:imce.ajaxComplete};};imce.ajaxItems=function(jsop,items,opt){return imce.ajax(jsop,$.extend(true,imce.ajaxItemsOpt(items),opt));};imce.ajaxItemsOpt=function(items){return {data:{selection:imce.getItemPaths(items)}};};imce.ajaxBeforeSend=function(xhr,opt){var handler;var Folder;if(handler=opt.customBeforeSend)if(handler.apply(this,arguments)===false){opt.activeFolder=null;return false;}if(Folder=opt.activeFolder)Folder.setBusy(true);};imce.ajaxSuccess=function(response,status){var handler;var opt=this;opt.response=response;imce.ajaxProcessResponse(response);if(handler=opt.customSuccess)handler.apply(opt,arguments);};imce.ajaxComplete=function(xhr,status){var Folder;var handler;var opt=this;if(Folder=opt.activeFolder)Folder.setBusy(false);if(handler=opt.customComplete)handler.apply(opt,arguments);opt.response=opt.activeFolder=null;};imce.ajaxError=function(xhr,status,e){if(status!=='abort')imce.setMessage('<pre class="imce-ajax-error">'+Drupal.checkPlain(imce.ajaxErrorMessage(xhr,this.url))+'</pre>');};imce.ajaxProcessResponse=function(response){if(response){imce.ajaxProcessRemoved(response);imce.ajaxProcessAdded(response);imce.ajaxProcessMessages(response);}};imce.ajaxProcessAdded=function(response){var path;var Folder;var added;if(added=response.added)for(path in added)if(Folder=imce.addFolder(path)){Folder.addContent(added[path],true);imce.contentEl.focus();}};imce.ajaxProcessRemoved=function(response){var i;var Item;var paths=response.removed;if(paths)for(i in paths)if(Item=imce.getItem(paths[i]))Item.remove();};imce.ajaxProcessMessages=function(response){var i;var type;var msgs=response.messages;if(msgs)for(type in msgs)if(imce.owns(msgs,type))for(i in msgs[type])if(msgs[type].hasOwnProperty(i))imce.setMessage(msgs[type][i],type);};imce.ajaxErrorMessage=function(xhr,url){var msg=Drupal.t('An AJAX HTTP error occurred.');msg+='\n'+Drupal.t('Path: !uri',{'!uri':url});msg+='\n'+Drupal.t('HTTP Result Code: !status',{'!status':xhr.status||0});msg+='\n'+Drupal.t('StatusText: !statusText',{'!statusText':xhr.statusText||'N/A'});msg+='\n'+Drupal.t('ResponseText: !responseText',{'!responseText':xhr.responseText||'N/A'});return msg;};imce.getItemPaths=function(items){return $.map(items,imce.getItemPath);};imce.getItemPath=function(Item){return Item.getPath();};imce.setMessage=function(msg,type){if(!type)type='error';var mq=imce.messageQueue;var len=mq.length;var msgId=msg+':'+type;if(len&&mq[len-1].msgId===msgId)return false;mq[len]=imce.createMessageEl(msg,type);mq[len].msgId=msgId;if(!imce.pmqScheduled)imce.pmqScheduled=setTimeout(imce.processMessageQueue,100);return false;};imce.processMessageQueue=function(){var mq=imce.messageQueue;if(mq.length){$(imce.createMessagePopupEl()).html(mq).fadeIn(200);mq.length=0;$(document).on('mousedown',imce.eMPopDocMousedown);imce.mPopCloseTimer=setTimeout(imce.mPopClose,2500);}};imce.mPopClose=function(){if(imce.mPopHovering){imce.mPopCloseTimerUp=1;return imce.mPopCloseTimerUp;}clearTimeout(imce.mPopCloseTimer);imce.mPopCloseTimerUp=0;$(document).off('mousedown',imce.eMPopDocMousedown);$(imce.messagePopupEl).fadeOut(400,imce.processMessageQueueNext);};imce.processMessageQueueNext=function(){imce.pmqScheduled=0;if(imce.messageQueue.length)imce.pmqScheduled=setTimeout(imce.processMessageQueue,250);};imce.eMPopMouseenter=function(e){imce.mPopHovering=1;if(imce.mPopCloseTimerUp)clearTimeout(imce.mPopCloseTimer);};imce.eMPopMouseleave=function(e){imce.mPopHovering=0;if(imce.mPopCloseTimerUp)imce.mPopCloseTimer=setTimeout(imce.mPopClose,2000);};imce.eMPopDocMousedown=function(e){if(!imce.mPopHovering)imce.mPopClose();};imce.createMessageEl=function(msg,type){var el=imce.createEl('<div class="imce-message imce-ficon"><div class="imce-message-content"></div></div>');el.className+=' '+type;el.firstChild.innerHTML=msg;return el;};imce.createMessagePopupEl=function(){var el=imce.messagePopupEl;if(!el){el=imce.messagePopupEl=imce.createLayer('imce-message-popup',imce.fmEl);$(el).on('mouseenter',imce.eMPopMouseenter).on('mouseleave',imce.eMPopMouseleave);}return el;};imce.permissionInFolderConf=function(permission,folderConf){var permissions=folderConf&&folderConf.permissions;return !!(permissions&&((permission in permissions)?permissions[permission]:permissions.all));};imce.hasPermission=function(permission,conf){var i;var folders=(conf||imce.conf).folders;if(folders)for(i in folders)if(imce.permissionInFolderConf(permission,folders[i]))return true;return false;};imce.sortText=function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1;};imce.sortNum=function(a,b){return (a||0)-(b||0);};imce.sortNumericProperty=function(a,b,prop){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=imce.sortNum(a[prop]||0,b[prop]||0);return result;};imce.sortBranchName=function(a,b){return imce.sortText(a.name,b.name);};imce.sorters.name=function(a,b){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=imce.sortText(a.name,b.name);return result;};imce.sorters.date=function(a,b){return imce.sortNumericProperty(a,b,'date');};imce.sorters.size=function(a,b){return imce.sortNumericProperty(a,b,'size');};imce.sorters.width=function(a,b){return imce.sortNumericProperty(a,b,'width');};imce.sorters.height=function(a,b){return imce.sortNumericProperty(a,b,'height');};imce.sorters.ext=function(a,b){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=(a.isFolder?0:imce.sortText(a.ext||'',b.ext||''));return result;};imce.splitPath=function(path){if(typeof path==='string'&&path!==''){var parts=path.split('/');var filename=parts.pop();var dirpath=parts.join('/');if(filename!=='')return [dirpath===''?'.':dirpath,filename];}};imce.joinPaths=function(dirpath,filename){if(dirpath==='.')return filename;if(filename==='.')return dirpath;if(dirpath.substring(dirpath.length-1)!=='/')dirpath+='/';return dirpath+filename;};imce.getQuery=function(name){var i;var part;var parts;var str;var query=imce.query;if(!query){query=imce.query={};if(str=location.search){parts=str.substring(1).split('&');for(i in parts)if(imce.owns(parts,i)){part=parts[i].split('=');query[imce.decode(part[0])]=part[1]?imce.decode(part[1]):'';}}}return name?query[name]:query;};imce.decode=function(str){try{str=decodeURIComponent(str);}catch(err){imce.delayError(err);}return str;};imce.delayError=function(err){setTimeout(function(){throw err;});};imce.formatDate=function(timestamp,dayOnly){var D;var p0;var ret='';if(timestamp){D=new Date(timestamp*1000);p0=imce.prependZero;ret=D.getFullYear()+'-'+p0(D.getMonth()+1)+'-'+p0(D.getDate());if(!dayOnly)ret+=' '+p0(D.getHours())+':'+p0(D.getMinutes());}return ret;};imce.formatSize=function(size){if(size==null)return '';if(!size||size<100)return Drupal.formatPlural(size,'1 byte','@count bytes',{'@count':size||0});if(size<1048576)return Drupal.t('@size KB',{'@size':imce.round(size/1024,1)});return Drupal.t('@size MB',{'@size':imce.round(size/1048576,1)});};imce.formatItemsStatus=function(count,size){return Drupal.t('!items (!size)',{'!items':Drupal.formatPlural(count,'1 item','@count items'),'!size':imce.formatSize(size)});};imce.prependZero=function(num){return num<10?'0'+num:num;};imce.round=function(num,precision){var n=Math.pow(10,precision);return Math.round(num*n)/n;};imce.getExt=function(name){var pos=name.lastIndexOf('.');return pos===-1?'':name.substring(pos+1);};imce.owns=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};imce.getFirstItem=function(items,prop,state){var i;var item;if(typeof state==="undefined")state=true;for(i in items)if(imce.owns(items,i)){item=items[i];if(!prop||(item[prop]?state:!state))return item;}};imce.resolveHandler=function(str,scope){if(!str)return;var i;var obj=scope||window;var parts=str.split('.');var len=parts.length;for(i=0;i<len&&(obj=obj[parts[i]]);i++){}return i===len&&obj&&obj.call&&obj.apply?obj:false;};imce.createEl=function(html){var el;var div=imce._div;if(!div)div=imce._div=document.createElement('div');div.innerHTML=html;el=div.firstChild;div.removeChild(el);return el;};imce.createLayer=function(cname,parent){var layer=imce.createEl('<div class="imce-layer"></div>');if(cname)layer.className+=' '+cname;if(parent!==false)(parent||document.body).appendChild(layer);return layer;};imce.removeEl=function(el){var parent=el.parentNode;if(parent)parent.removeChild(el);};imce.getWindowSize=function(){return {width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};};imce.getWindowScroll=function(){if(typeof window.pageXOffset==="undefined"){var el=document.documentElement;return {left:el.scrollLeft,top:el.scrollTop};}return {left:window.pageXOffset,top:window.pageYOffset};};imce.eFix=function(event){return $.event.fix(event||window.event);};imce.scrollToEl=function(el,wrpEl,diffTop,diffBottom){if(el.offsetWidth&&wrpEl.scrollHeight>wrpEl.clientHeight){var elTop=$(el).offset().top;var elBottom=elTop+el.offsetHeight;var wrpTop=$(wrpEl).offset().top;var wrpBottom=wrpTop+wrpEl.offsetHeight;wrpTop+=diffTop||0;wrpBottom-=diffBottom||0;if(elTop<wrpTop)wrpEl.scrollTop-=wrpTop-elTop+10;else{if(wrpBottom<elBottom)wrpEl.scrollTop+=Math.min(elBottom-wrpBottom+10,elTop-wrpTop-10);}}};imce.countElPerRow=function(el){return Math.max(1,parseInt(el.parentNode.clientWidth/$(el).outerWidth(true)));};imce.fixPosition=function(el){var pos=$(el).offset();var winSize=imce.getWindowSize();var winScroll=imce.getWindowScroll();var scrollbar=18;var extraX=pos.left-winScroll.left+el.offsetWidth-winSize.width+scrollbar;var extraY=pos.top-winScroll.top+el.offsetHeight-winSize.height+scrollbar;if(extraX>0)el.style.left=Math.max(0,pos.left-extraX)+'px';if(extraY>0)el.style.top=Math.max(0,pos.top-extraY)+'px';};imce.bindDragDrop=function(drag,drop,data,isTouch){var edata={drag,drop,data,isTouch};$(document).on(isTouch?'touchmove':'mousemove',edata,imce.eDocDrag).on(isTouch?'touchend':'mouseup',edata,imce.eDocDrop);};imce.eDocDrag=function(e){var edata=e.data;if(edata.drag){if(edata.isTouch)e=imce.eTouchFix(e,e.originalEvent.changedTouches[0]);return edata.drag.call(this,e);}};imce.eDocDrop=function(e){var edata=e.data;$(document).off(edata.isTouch?'touchmove':'mousemove',imce.eDocDrag).off(edata.isTouch?'touchend':'mouseup',imce.eDocDrop);if(edata.drop){if(edata.isTouch)e=imce.eTouchFix(e,e.originalEvent.changedTouches[0]);return edata.drop.call(this,e);}};imce.eTouchFix=function(e,touch){e=$.event.fix(e);if(touch&&typeof touch.pageX!=="undefined"){e.pageX=touch.pageX;e.pageY=touch.pageY;e.clientX=touch.clientX;e.clientY=touch.clientY;}return e;};imce.eCommonTouchstart=function(event,callback,context){var touch;var touches=event.changedTouches;if(touches&&(touch=touches[0])&&!touches[1]){if(callback&&callback.call)return callback.call(context||this,imce.eTouchFix(event,touch),true);return false;}};})(jQuery,Drupal);;
(function($,Drupal,imce){'use strict';imce.Item=function(name){this.construct(name);};var Item=imce.Item.prototype;Item.construct=function(name){this.createEl();this.setName(name);};Item.createEl=function(){var el;var children;var Item=this;if(!Item.el){el=Item.el=imce.createEl('<div class="imce-item"><div class="imce-item-date"></div><div class="imce-item-height"></div><div class="imce-item-width"></div><div class="imce-item-size"></div><div class="imce-item-icon imce-ficon"></div><div class="imce-item-name"></div></div>');el.onmousedown=imce.eItemMousedown;el.ondblclick=imce.eItemDblclick;el.Item=Item;children=el.children;Item.dateEl=children[0];Item.heightEl=children[1];Item.widthEl=children[2];Item.sizeEl=children[3];Item.iconEl=children[4];Item.nameEl=children[5];}};Item.appendTo=function(parent){parent.appendItem(this);};Item.remove=function(shallow){if(this.parent)this.parent.removeItem(this,shallow);};Item.click=function(e){var Item=this;if(e){if(e.shiftKey){var Folder=imce.activeFolder;var lastItem=imce.getLastSelected();var start=lastItem?Folder.indexOf(lastItem):-1;var end=Folder.indexOf(Item);var step=start<end?1:-1;while(start!==end)Folder.getItemAt(start+=step).select();return;}if(e.ctrlKey)return Item.toggleSelect();}var i;var selection=imce.getSelection();for(i in selection)if(imce.owns(selection,i)&&selection[i]!==Item)selection[i].deselect();Item.select();};Item.dblClick=function(){if(imce.sendtoHandler)imce.runSendtoHandler([this]);else this.open();};Item.open=function(){var url=this.getUrl();if(url)window.open(url);};Item.select=function(){imce.selectItem(this);};Item.deselect=function(){imce.deselectItem(this);};Item.toggleSelect=function(){if(this.selected)this.deselect();else this.select();};Item.setBusy=function(state){this.toggleState('busy',!!state);};Item.setDisabled=function(state){this.toggleState('disabled',!!state);};Item.isReady=function(){return !this.disabled&&!this.busy;};Item.getPath=function(){var parent;var path=this.path;if(path)return path;if(parent=this.parent)if(path=parent.getPath())return imce.joinPaths(path,this.name);};Item.setPath=function(path){this.path=path;};Item.getUri=function(){var path=this.getPath();if(path)return imce.joinPaths(imce.getConf('root_uri','/'),path);};Item.getUrl=function(absolute,uncached){var url=this.url;if(!url){var rootUrl=imce.getConf('root_url');if(rootUrl){var path=encodeURIComponent(this.getPath()).replace(/%2F/g,'/');url=imce.joinPaths(rootUrl,path);}}if(url){if(absolute&&url.charAt(0)==='/'&&url.charAt(1)!=='/')url=location.protocol+'//'+location.host+url;if(uncached)url+=(url.indexOf('?')===-1?'?':'&')+('s'+this.size)+('d'+this.date);}return url||'';};Item.formatUri=function(){return Drupal.checkPlain(this.getUri());};Item.formatPath=function(){return Drupal.checkPlain(this.path==='.'?this.name:this.getPath());};Item.formatName=function(){return Drupal.checkPlain(this.name);};Item.formatSize=function(){return imce.formatSize(this.size);};Item.formatDate=function(dayOnly){return imce.formatDate(this.date,dayOnly);};Item.formatWidth=function(){return this.width?this.width*1+'':'';};Item.formatHeight=function(){return this.height?this.height*1+'':'';};Item.formatDimensions=function(){return this.width?this.width*1+'x'+this.height*1:'';};Item.extend=function(props){if(props)for(var i in props){if(!imce.owns(props,i))continue;this.setProperty(i,props[i]);}};Item.setProperty=function(prop,val){var oldval=this[prop];if(oldval!==val){this[prop]=val;this.triggerPropertyChange(prop,oldval);}};Item.setName=function(name){this.setProperty('name',name);};Item.triggerPropertyChange=function(prop,oldval){var method='on'+prop.charAt(0).toUpperCase()+prop.substring(1)+'Change';if(this[method]){this[method](oldval);if(this===imce.previewingItem)imce.updatePreview();}};Item.onNameChange=function(oldname){var Item=this;var name=Item.formatName();Item.nameEl.innerHTML=name;Item.nameEl.title=name;if(Item.parent)Item.parent.onItemNameChange(Item,oldname);};Item.onThumbnailChange=function(oldval){if(this.thumbnail){this.iconEl.innerHTML='<img src="'+this.thumbnail+'" alt="thumbnail">';this.iconEl.className+=' imce-item-thumbnail';}else{this.iconEl.innerHTML='';$(this.iconEl).removeClass('imce-item-thumbnail');}};Item.onSizeChange=function(oldval){var size=this.formatSize();this.sizeEl.innerHTML=size;this.sizeEl.title=size;};Item.onDateChange=function(oldval){var date=this.formatDate(true);this.dateEl.innerHTML=date;this.dateEl.title=date;};Item.onWidthChange=function(oldval){var width=this.formatWidth();this.widthEl.innerHTML=width;this.widthEl.title=width;};Item.onHeightChange=function(oldval){var height=this.formatHeight();this.heightEl.innerHTML=height;this.heightEl.title=height;};Item.createPreviewEl=function(){var el;var Item=this;var prvEl=imce.createEl('<div class="imce-item-preview"></div>');var infoEl=imce.createEl('<div class="imce-preview-info"></div>');prvEl.appendChild(infoEl);if(Item.isFolder){infoEl.appendChild(imce.createEl('<div class="path">'+Item.formatUri()+'</div>'));prvEl.className+=' folder';}else{var url=Item.getUrl(true);infoEl.appendChild(imce.createEl('<div class="url"><a href="'+url+'" target="_blank">'+url+'</a></div>'));}if(Item.size)infoEl.appendChild(imce.createEl('<div class="size">'+Item.formatSize()+'</div>'));if(Item.width)infoEl.appendChild(imce.createEl('<div class="dimensions">'+Item.formatDimensions()+'</div>'));if(Item.date)infoEl.appendChild(imce.createEl('<div class="date">'+Item.formatDate()+'</div>'));if(Item.isImageSource()&&imce.getConf('preview_images',1)){el=imce.createEl('<div class="imce-preview-image"><img src="'+Item.getUrl(false,true)+'"></div>');prvEl.appendChild(el);prvEl.className+=' image';el.firstChild.onclick=imce.ePrvImgClick;}return prvEl;};Item.setState=function(name){var el;var Item=this;if(!Item[name]){Item[name]=true;$(Item.el).addClass(name);if(el=Item.branchEl)$(el).addClass(name);}};Item.unsetState=function(name){var el;var Item=this;if(Item[name]){Item[name]=false;$(Item.el).removeClass(name);if(el=Item.branchEl)$(el).removeClass(name);}};Item.toggleState=function(name,state){if(state==null)state=!this[name];this[state?'setState':'unsetState'](name);};Item.scrollIntoView=function(){imce.scrollToEl(this.el,imce.contentEl,imce.contentHeaderEl.offsetHeight,imce.contentStatusEl.offsetHeight);};Item.isImageSource=function(){return this.width||this.ext&&this.ext.toLowerCase()==='svg';};imce.eItemMousedown=function(event){var e=imce.eFix(event);this.Item.click(e);return !(e.ctrlKey||e.shiftKey);};imce.eItemDblclick=function(event){this.Item.dblClick();return false;};imce.ePrvImgClick=function(){var Item=imce.previewingItem;if(Item)Item.dblClick();return false;};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.File=function(name){this.construct(name);};var ItemProto=imce.Item.prototype;var File=$.extend(imce.File.prototype,ItemProto);File.construct=function(name){this.isFile=true;this.type='file';ItemProto.construct.apply(this,arguments);};File.createEl=function(){if(!this.el){ItemProto.createEl.apply(this,arguments);this.el.className+=' file';}};File.onNameChange=function(oldval){ItemProto.onNameChange.apply(this,arguments);var File=this;var newext=imce.getExt(File.name);if(File.ext!==newext){if(File.ext!=null)if(File.ext)$(File.el).removeClass('file-'+File.ext.toLowerCase());if(newext)File.el.className+=' file-'+newext.toLowerCase();File.ext=newext;}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.Folder=function(name,conf){this.construct(name,conf);};var ItemProto=imce.Item.prototype;var Folder=$.extend(imce.Folder.prototype,ItemProto);Folder.construct=function(name,conf){var Folder=this;Folder.isFolder=true;Folder.type='folder';Folder.items=[];Folder.files={};Folder.subfolders={};ItemProto.construct.apply(Folder,arguments);Folder.setConf(conf);};Folder.createEl=function(){var nameEl;var toggleEl;var branchEl;var Folder=this;if(!Folder.el){ItemProto.createEl.apply(Folder,arguments);Folder.el.className+=' folder';Folder.contentEl=imce.createEl('<div class="imce-folder-content clearfix"></div>');Folder.subtreeEl=imce.createEl('<div class="imce-subtree"></div>');branchEl=Folder.branchEl=imce.createEl('<div class="imce-branch"><span class="imce-branch-toggle"></span><span class="imce-branch-name imce-ficon"></span></div>');toggleEl=Folder.branchToggleEl=branchEl.firstChild;toggleEl.onclick=imce.eBranchToggleClick;nameEl=Folder.branchNameEl=branchEl.children[1];nameEl.onclick=imce.eBranchNameClick;branchEl.Folder=nameEl.Folder=toggleEl.Folder=Folder;}};Folder.setContent=function(content){var i;var Item;var list;var Folder=this;var items=Folder.getItems();for(i in items){if(!imce.owns(items,i))continue;Item=items[i];list=Item.isFolder?content.subfolders:content.files;if(!list||!imce.owns(list,Item.name))if(!Item.isFolder||!Item.hasPredefinedPath())Folder.removeItem(Item);}Folder.extend(content.props);Folder.addContent(content);Folder.content=content;Folder.updateSubtree();};Folder.addContent=function(content,selectNew){var Folder=this;var files=content.files;var subfolders=content.subfolders;if(!files&&!subfolders)return;Folder.addItems(files,'file');Folder.addItems(subfolders,'folder');if(Folder.active)Folder.sortItems();else Folder.needSort=1;Folder.sortTree();if(selectNew&&Folder.active){var name;var fname;var sname;imce.deselectAll();if(files)for(fname in files){if(!imce.owns(files,fname))continue;Folder.getItem(fname).select();}if(subfolders)for(sname in subfolders){if(!imce.owns(subfolders,sname))continue;Folder.getItem(sname).select();}if(name=(fname||sname))Folder.getItem(name).scrollIntoView();}};Folder.addItems=function(items,type){var Item;var name;var Type=type==='folder'?imce.Folder:imce.File;if(items)for(name in items)if(Item=this.getItem(name)){Item.extend(items[name]);this.updateStatus();}else{Item=new Type(name);Item.extend(items[name]);this.appendItem(Item);}};Folder.getItems=function(){return this.items.slice(0);};Folder.appendItem=function(Item){var Folder=this;var name=Item.name;var existing;if(!Folder.validateAppend(Item))return;Item.remove(true);if(existing=Folder.getItem(name))existing.remove();Folder.items.push(Item);Item.parent=Folder;Folder.contentEl.appendChild(Item.el);if(Item.isFolder){Folder.prepareSubtree();Folder.subtreeEl.appendChild(Item.branchEl);Folder.subfolders[name]=Item;Item.setPath((Folder.parent?Folder.path+'/':'')+Item.name);}else Folder.files[name]=Item;Folder.updateStatus();};Folder.removeItem=function(Item,shallow){var name=Item.name;var Folder=this;if(Item.parent!==Folder)return;if(!shallow)if(Item.isFolder)for(var i in Item.items){if(!imce.owns(Item.items,i))continue;Item.removeItem(Item.items[i]);}Item.deselect();Item.setBusy(false);if(Item.isFolder){if(Item.active)Folder.activate();Item.setPath(null);delete Folder.subfolders[name];imce.removeEl(Item.branchEl);Folder.updateSubtree();}else delete Folder.files[name];Folder.items.splice(Folder.indexOf(Item),1);delete Item.parent;imce.removeEl(Item.el);Folder.updateStatus();};Folder.setPath=function(newpath){var i;var Folder=this;var oldpath=Folder.path;var subfolders=Folder.subfolders;if(oldpath!==newpath)if(newpath==null){for(i in subfolders){if(!imce.owns(subfolders,i))continue;subfolders[i].setPath(null);}delete imce.tree[oldpath];delete Folder.path;}else{Folder.path=newpath;imce.tree[newpath]=Folder;Folder.setDisabled(!Folder.getConf());for(i in subfolders){if(!imce.owns(subfolders,i))continue;subfolders[i].setPath(newpath+'/'+subfolders[i].name);}Folder.updateStatus();}};Folder.getPermission=function(name){return imce.permissionInFolderConf(name,this.getConf());};Folder.getConf=function(){var conf=this.conf;var parent;if(conf)return conf;if(parent=this.parent)if(conf=parent.getConf())if(imce.permissionInFolderConf('browse_subfolders',conf))return $.extend({inherited:true},conf);};Folder.setConf=function(conf){if(this.conf!==conf){this.conf=conf;this.setDisabled(!this.getConf());}};Folder.open=function(refresh){if(refresh||!this.content)this.load();this.activate();};Folder.load=function(){if(this.isReady()){this.setLoading(true);imce.ajax('browse',{activeFolder:this,customComplete:imce.xFolderLoadComplete});}};Folder.activate=function(){var Folder=this;var oldFolder=imce.activeFolder;var parent=Folder.parent;if(!Folder.active){if(oldFolder)oldFolder.deactivate();if(Folder.needSort)Folder.sortItems();imce.activeFolder=Folder;Folder.active=true;$(Folder.branchEl).addClass('active');if(!Folder.loading)Folder.addContentToDom();Folder.setContentVisibility(true);while(parent){parent.expand();parent=parent.parent;}Folder.updateHeader();Folder.updateStatus();imce.trigger('activateFolder',Folder,oldFolder);}};Folder.deactivate=function(){var Folder=this;if(Folder.active){Folder.setContentVisibility(false);imce.deselectAll();imce.activeFolder=null;Folder.active=false;$(Folder.branchEl).removeClass('active');}};Folder.setLoading=function(state){var Folder=this;if(state){if(!Folder.loading){Folder.setBusy(true);Folder.setState('loading');if(Folder.active)imce.deselectAll();}}else{if(Folder.loading){Folder.setBusy(false);Folder.unsetState('loading');if(Folder.active)Folder.addContentToDom();}}};Folder.getItem=function(name){var Folder=this;if(imce.owns(Folder.files,name))return Folder.files[name];if(imce.owns(Folder.subfolders,name))return Folder.subfolders[name];};Folder.getItemAt=function(i){return this.items[i];};Folder.indexOf=function(Item){return $.inArray(Item,this.items);};Folder.selectAll=function(){for(var i in this.items){if(!imce.owns(this.items,i))continue;this.items[i].select();}};Folder.countItems=function(){return this.items.length;};Folder.countSubfolders=function(){var i;var count=0;for(i in this.subfolders){if(!imce.owns(this.subfolders,i))continue;count++;}return count;};Folder.onNameChange=function(oldval){ItemProto.onNameChange.apply(this,arguments);this.branchNameEl.innerHTML=Drupal.checkPlain(this.name);this.branchNameEl.title=this.name;};Folder.onItemNameChange=function(Item,oldname){var Folder=this;var name=Item.name;var group=Item.isFolder?Folder.subfolders:Folder.files;delete group[oldname];group[name]=Item;if(Item.isFolder)Item.setPath((Folder.parent?Folder.path+'/':'')+name);};Folder.dblClick=function(){this.open();};Folder.addContentToDom=function(){var el=this.contentEl;var parentEl=imce.contentEl;if(el.parentNode!==parentEl)parentEl.appendChild(el);};Folder.setContentVisibility=function(show){var el=this.contentEl;el.style.display=show?'':'none';if(el.scrollTop)el.scrollTop=0;};Folder.prepareSubtree=function(){var Folder=this;if(Folder.subtreeEl.parentNode!==Folder.branchEl){Folder.branchEl.appendChild(Folder.subtreeEl);$(Folder.branchEl).removeClass('leaf');if(!Folder.active&&imce.activeFolder){Folder.expanded=true;Folder.shrink();}else Folder.expand();}};Folder.updateSubtree=function(){if(!this.countSubfolders()){this.shrink();imce.removeEl(this.subtreeEl);$(this.branchEl).addClass('leaf');}};Folder.expand=function(){if(!this.expanded){this.expanded=true;$(this.branchEl).addClass('expanded');$(this.subtreeEl).show();}};Folder.shrink=function(){if(this.expanded){this.expanded=false;$(this.branchEl).removeClass('expanded');$(this.subtreeEl).hide();}};Folder.updateStatus=function(){if(this.active)imce.updateStatus();};Folder.updateHeader=function(){if(this.active)imce.updateHeader();};Folder.sortItems=function(key,desc){var i;var sorter;var Folder=this;var items=Folder.items;var active=Folder.activeSort||imce.activeSort||imce.local.activeSort||{};if(key==null)key=active.key||'name';if(desc==null)desc=!!active.desc;Folder.needSort=0;if(sorter=imce.sorters[key]){items.sort(sorter);if(desc)items.reverse();for(i in items){if(!imce.owns(items,i))continue;this.contentEl.appendChild(items[i].el);}Folder.activeSort={key,desc};Folder.updateHeader();}};Folder.sortTree=function(){var i;var Folder=this;var subfolders=Folder.subfolders;var arr=[];for(i in subfolders){if(!imce.owns(subfolders,i))continue;arr.push(subfolders[i]);}if(arr.length>1){arr.sort(imce.sortBranchName);for(i in arr){if(!imce.owns(arr,i))continue;Folder.subtreeEl.appendChild(arr[i].branchEl);}}};Folder.validateAppend=function(Item,copy){if(Item===this)return false;var parent=Item.parent;if(!parent)return true;if(!copy&&parent===this)return false;if(Item.isFolder)for(parent=this.parent;parent;parent=parent.parent)if(parent===Item)return false;return true;};Folder.isPredefined=function(){return !!this.conf;};Folder.hasPredefinedPath=function(){if(this.isPredefined())return this;var i;var Folder;var subfolders=this.subfolders;for(i in subfolders)if(Folder=subfolders[i].hasPredefinedPath())return Folder;return false;};Folder.formatStatus=function(){return '<div class="items">'+imce.formatItemsStatus(this.countItems(),this.getSize())+'</div>';};Folder.getSize=function(){var i;var size=0;var files=this.files;for(i in files){if(!imce.owns(files,i))continue;size+=files[i].size||0;}return size;};imce.eBranchNameClick=function(event){this.Folder.open();return false;};imce.eBranchToggleClick=function(event){var Folder=this.Folder;if(Folder.countSubfolders())if(Folder.expanded)Folder.shrink();else Folder.expand();else Folder.open();return false;};imce.xFolderLoadComplete=function(xhr,status){var content;var opt=this;var Folder=opt.activeFolder;var response=opt.response;if(response&&(content=response.content))Folder.setContent(content);Folder.setLoading(false);if(Folder.countSubfolders())Folder.expand();};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.Tbb=function(id,opt){this.construct(id,opt);};var Tbb=imce.Tbb.prototype;Tbb.construct=function(id,opt){var Tbb=imce.toolbarButtons[id]=this;Tbb.id=id;$.extend(Tbb,opt);var el=Tbb.createEl();var parent=imce.toolbarEl;if(Tbb.prepend&&parent.firstChild)parent.insertBefore(el,parent.firstChild);else parent.appendChild(el);if(Tbb.shortcut)imce.addShortcut(Tbb.shortcut,el);};Tbb.createEl=function(){var Tbb=this;var el=Tbb.el;var icon;if(!el){el=Tbb.el=imce.createEl('<span class="imce-tbb imce-ficon" role="button"><span class="imce-tbb-title"></span></span>');if(icon=Tbb.icon)el.className+=' imce-ficon-'+icon;el.className+=' imce-tbb--'+Tbb.id;el.title=(Tbb.tooltip||Tbb.title)+(Tbb.shortcut?' ('+Tbb.shortcut+')':'');el.onclick=imce.eTbbClick;el.Tbb=Tbb;el.firstChild.innerHTML=Tbb.title;}return el;};Tbb.createPopupEl=function(){var Tbb=this;var el=Tbb.popupEl;if(!el){el=Tbb.popupEl=imce.createLayer('imce-tbb-popup');el.className+=' imce-tbb-popup--'+Tbb.id;el.onkeydown=imce.eTbbPopupKeydown;el.Tbb=Tbb;if(Tbb.content)el.appendChild(Tbb.content);}return el;};Tbb.openPopup=function(autoclose){var Tbb=this;if(!Tbb.active){Tbb.createPopupEl();Tbb.setActive(true);var popupEl=Tbb.popupEl;var $el=$(Tbb.el);var css=$el.offset();css.top+=$el.outerHeight(true);$(popupEl).css(css).fadeIn();imce.fixPosition(popupEl);$('form').find('input,select,textarea').filter(':visible').eq(0).trigger('focus');if(autoclose)$(document).on('mousedown',{Tbb},imce.eTbbDocMousedown);if(Tbb.onopen)Tbb.onopen.apply(Tbb,arguments);}};Tbb.closePopup=function(){var Tbb=this;if(Tbb.popupEl&&Tbb.active){Tbb.setActive(false);$(Tbb.popupEl).hide();imce.contentEl.focus();if(Tbb.onclose)Tbb.onclose.apply(Tbb,arguments);}};Tbb.setActive=function(state){this.toggleState('active',!!state);};Tbb.setBusy=function(state){this.toggleState('busy',!!state);};Tbb.setDisabled=function(state){this.toggleState('disabled',!!state);};Tbb.toggleState=function(name,state){var Tbb=this;var oldState=Tbb[name];if(state==null)state=!oldState;if(state){if(!oldState){Tbb[name]=true;$(Tbb.el).addClass(name);}}else{if(oldState){Tbb[name]=false;$(Tbb.el).removeClass(name);}}};Tbb.click=function(event){var Tbb=this;if(!Tbb.disabled){if(Tbb.handler&&!Tbb.busy)Tbb.handler.call(Tbb,imce.eFix(event));if(Tbb.content)Tbb.openPopup(true);}};imce.eTbbClick=function(event){this.Tbb.click(event);};imce.eTbbDocMousedown=function(e){var Tbb=e.data.Tbb;var el=Tbb.popupEl;if(el!==e.target&&!$.contains(el,e.target)){Tbb.closePopup();$(document).off('mousedown',imce.eTbbDocMousedown);}};imce.eTbbPopupKeydown=function(event){var e=event||window.event;if(e.keyCode===27){this.Tbb.closePopup();return false;}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.newfolderInit=function(){if(imce.hasPermission('create_subfolders'))imce.addTbb('newfolder',{title:Drupal.t('New folder'),permission:'create_subfolders',content:imce.createNewfolderForm(),shortcut:'Ctrl+N',icon:'folder-add'});});imce.createNewfolderForm=function(){var form=imce.newfolderForm;if(!form){form=imce.newfolderForm=imce.createEl('<form class="imce-newfolder-form"><input type="text" name="newfolder" class="imce-newfolder-input" size="16" /><button type="submit" name="op" class="imce-newfolder-button">'+Drupal.t('Create')+'</button></form>');form.elements.newfolder.placeholder=Drupal.t('Folder name');form.onsubmit=imce.eNewfolderSubmit;}return form;};imce.eNewfolderSubmit=function(){var name=this.elements.newfolder.value;if(imce.validateNewfolder(name)){imce.ajax('newfolder',{data:{newfolder:name}});imce.getTbb('newfolder').closePopup();}return false;};imce.validateNewfolder=function(name,parentFolder){if(!parentFolder)parentFolder=imce.activeFolder;if(!parentFolder.isReady()||!parentFolder.getPermission('create_subfolders')||!imce.validateFileName(name))return false;if(parentFolder.getItem(name)){imce.setMessage(Drupal.t('%filename already exists.',{'%filename':name}));return false;}return true;};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.uploadInit=function(){if(imce.hasPermission('upload_files'))imce.addTbb('upload',{title:Drupal.t('Upload'),permission:'upload_files',content:imce.createUploadForm(),shortcut:'Ctrl+Alt+U',icon:'upload'});});imce.createUploadForm=function(){var els;var el;var exts;var form=imce.uploadForm;var name='files[imce][]';if(form)return form;form=imce.uploadForm=imce.createEl('<form class="imce-upload-form" method="post" enctype="multipart/form-data" accept-charset="UTF-8">'+'<div class="imce-form-item imce-form-file">'+'<label>'+Drupal.t('File')+'</label>'+'<input type="file" name="'+name+'" class="imce-file-input" multiple />'+'</div>'+'<div class="imce-form-actions">'+'<button type="submit" name="op" class="imce-upload-button">'+Drupal.t('Upload')+'</button>'+'</div>'+'<input type="hidden" name="jsop" value="upload" />'+'<input type="hidden" name="token" />'+'</form>');form.action=imce.getConf('ajax_url');els=form.elements;els.token.value=imce.getConf('token');el=els[name];exts=imce.getConf('extensions','');if(exts!=='*')el.accept='.'+exts.replace(/\s+/g,',.');if(imce.canAjaxUpload()){imce.activeUq=new imce.UploadQueue({name,accept:el.accept});form.insertBefore(imce.activeUq.el,form.firstChild);form.className+=' uq';if(imce.getConf('upload_auto_start',1))form.className+=' auto-start';form.onsubmit=imce.eUploadQueueSubmit;}else{form.setAttribute('target','imce_upload_iframe');form.appendChild(imce.createEl('<input type="hidden" name="active_path" />'));form.appendChild(imce.createEl('<input type="hidden" name="return_html" value="1" />'));form.onsubmit=imce.eUploadIframeSubmit;}return form;};imce.eUploadQueueSubmit=function(event){imce.activeUq.start();return false;};imce.eUploadIframeSubmit=function(event){if(!imce.validateUploadForm(this))return false;imce.createUploadIframe();this.elements.active_path.value=imce.activeFolder.getPath();imce.uploadSetBusy(true);};imce.validateUploadForm=function(form){var i;var file;var input=form.elements['files[imce][]'];var files=input.files;if(files){if(!files.length)return false;for(i=0;file=files[i];i++)if(!imce.validateFileUpload(file))return false;return true;}if(input.value){file={name:input.value.split(input.value.indexOf('/')===-1?'\\':'/').pop()};return imce.validateFileUpload(file);}return false;};imce.validateFileUpload=function(file){var exts=imce.getConf('extensions','');if(exts!=='*'&&!imce.validateExtension(imce.getExt(file.name),exts))return false;var maxsize=imce.getConf('maxsize');if(maxsize&&file.size&&file.size>maxsize){imce.setMessage(Drupal.t('%filename is %filesize exceeding the maximum file size of %maxsize.',{'%filename':file.name,'%filesize':imce.formatSize(file.size),'%maxsize':imce.formatSize(maxsize)}));return false;}if(!imce.validateFileName(file.name))return false;return $.inArray(false,imce.trigger('validateFileUpload',file))===-1;};imce.createUploadIframe=function(){var el=imce.uploadIframe;if(!el){el=imce.uploadIframe=imce.createEl('<iframe name="imce_upload_iframe" class="imce-upload-iframe" style="position: absolute; top: -9999px; left: -9999px;" src="javascript: "></iframe>');document.body.appendChild(el);setTimeout(function(){el.onload=imce.eUploadIframeLoad;});}return el;};imce.eUploadIframeLoad=function(event){var text;var response;var doc;var $body;var el=this;try{doc=el.contentDocument||el.contentWindow&&el.contentWindow.document;if(doc){$body=$(doc.body);if(text=$body.find('textarea').eq(0).val())response=$.parseJSON(text);$body.empty();}}catch(err){imce.delayError(err);}imce.uploadIframeComplete(response,text);};imce.uploadIframeComplete=function(response,text){if(response){imce.ajaxProcessResponse(response);if(response.added){imce.uploadResetInput(imce.uploadForm.elements['files[imce][]']);imce.getTbb('upload').closePopup();}}else{imce.setMessage(Drupal.t('Invalid response received from the server.'));if(text)imce.setMessage('<pre>'+Drupal.checkPlain(text)+'</pre>');}imce.uploadSetBusy(false);};imce.uploadSetBusy=function(state){$('.imce-upload-button',imce.uploadForm).toggleClass('busy',state)[0].disabled=state;};imce.canAjaxUpload=function(){var support=imce.ajaxUploadSupport;if(support==null){try{support=!!(window.FormData&&(new XMLHttpRequest().upload));}catch(err){support=false;}imce.ajaxUploadSupport=support;}return support;};imce.uploadResetInput=function(input){if($(input).val('').val()){var form=document.createElement('form');var parent=input.parentNode;form.style.display='none';parent.insertBefore(form,input);form.appendChild(input);form.reset();parent.insertBefore(input,form);parent.removeChild(form);}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.UploadQueue=function(conf){this.construct(conf);};var Uq=imce.UploadQueue.prototype;Uq.construct=function(conf){var Uq=this;Uq.items={};Uq.queue=[];Uq.conf=$.extend({name:'files[imce][]'},conf);Uq.createEl();};Uq.createEl=function(){var Uq=this;var el=Uq.el;var inputEl;var accept;if(!el){el=Uq.el=imce.createEl('<div class="imce-uq"><span class="imce-uq-button imce-ficon imce-ficon-plus"><span class="imce-uq-label">'+Drupal.t('Add file')+'</span><input type="file" class="imce-uq-input" multiple /></span><div class="imce-uq-items"></div></div>');inputEl=Uq.inputEl=el.firstChild.lastChild;inputEl.onchange=imce.eUqInputChange;if(accept=Uq.conf.accept)inputEl.accept=accept;Uq.itemsEl=el.lastChild;el.Uq=inputEl.Uq=Uq;}return el;};Uq.start=function(){var Uq=this;if(!Uq.running&&Uq.queue.length)if(Uq.next()){Uq.running=true;imce.uploadSetBusy(true);}return Uq.running;};Uq.end=function(){if(this.running){this.running=false;imce.uploadSetBusy(false);imce.getTbb('upload').closePopup();}};Uq.next=function(){var i;var Item;var queue=this.queue.slice(0);for(i=0;Item=queue[i];i++)if(Item.completed)Item.remove();else{if(Item.start())return Item;}this.end();};Uq.selectFiles=function(list){var i;var file;var Item;var ret;var path=imce.activeFolder.getPath();for(i=0;file=list[i];i++)if(imce.validateFileUpload(file)){Item=new imce.UploadQueueItem(file,path);if(this.addItem(Item)){if(!ret)ret={};ret[i]=Item.id;}else Item.remove();}return ret;};Uq.getItem=function(id){return this.items[id];};Uq.addItem=function(Item){var existing;var Uq=this;var id=Item.id;if(existing=Uq.getItem(id))existing.remove(true);Item.Uq=Uq;Uq.items[id]=Uq.queue[Uq.queue.length]=Item;Uq.itemsEl.appendChild(Item.el);return Item;};Uq.removeItem=function(Item,quick){var Uq=this;var queue=Uq.queue;var i=$.inArray(Item,queue);if(i!==-1){queue.splice(i,1);delete Uq.items[Item.id];if(quick)$(Item.el).remove();else $(Item.el).fadeOut(1000,imce.eUqItemFadeout);return Item;}};Uq.ajaxPrepare=function(Item){var i;var field;var data;var formData;var Folder;var Uq=this;var file=Item.file;var dest=Item.destination;if(!file||!dest||!(Folder=imce.getFolder(dest)))return;data=$(Uq.inputEl.form).serializeArray().concat([{name:'active_path',value:dest}],Item.formData||[]);formData=new FormData();for(i=0;field=data[i];i++)if(field.name)formData.append(field.name,field.value);formData.append(Uq.conf.name,Item.file);return $.extend(imce.ajaxDefaults(),{data:formData,processData:false,contentType:false,customBeforeSend:imce.xUqItemBeforeSend,customComplete:imce.xUqItemComplete,xhr:imce.xUqItemXhr,itemId:Item.id,activeFolder:Folder});};imce.UploadQueueItem=function(file,destination){this.construct(file,destination);};var UqItem=imce.UploadQueueItem.prototype;UqItem.construct=function(file,destination){this.file=file;this.destination=destination;this.id=imce.joinPaths(destination,file.name);this.createEl();};UqItem.createEl=function(){var cancelEl;var name;var Item=this;var el=Item.el;var file=Item.file;if(!el){name=Drupal.checkPlain(file.name);el=Item.el=imce.createEl('<div class="imce-uqi"><div class="imce-uqi-cancel"></div><div class="imce-uqi-info"><span class="imce-uqi-name" title="'+name+'">'+name+'</span><span class="imce-uqi-size">'+imce.formatSize(file.size)+'</span></div><div class="imce-uqi-progress"><div class="imce-uqi-bar"></div></div><div class="imce-uqi-percent">'+Drupal.t('!percent%',{'!percent':0})+'</div></div>');el.Item=Item;cancelEl=el.firstChild;cancelEl.onclick=imce.eUqItemCancelClick;cancelEl.onmousedown=imce.eUqItemCancelMousedown;}return el;};UqItem.remove=function(quick){var ret;var Item=this;var Uq=Item.Uq;Item.stop();if(Uq)Uq.removeItem(Item,quick);Item.Uq=Item.xhr=Item.file=Item.formData=Item.el.Item=null;return ret;};UqItem.start=function(){var opt;var Item=this;var Uq=Item.Uq;if(Uq&&!Item.active&&!Item.completed)if(opt=Uq.ajaxPrepare(Item)){Item.active=true;$(Item.el).addClass('active');Item.xhr=$.ajax(opt);Uq.activeItem=Item;return Uq.activeItem;}};UqItem.stop=function(){var Item=this;if(Item.active){Item.active=false;$(Item.el).removeClass('active');if(Item.xhr)Item.xhr.abort();Item.complete();}};UqItem.complete=function(status){var Item=this;var Uq=Item.Uq;if(!Item.completed){Item.completed=true;Item.status=status;$(Item.el).addClass(status?'success':'fail');if(status)$('.imce-uqi-percent',Item.el).html(Drupal.t('!percent%',{'!percent':100}));if(Uq&&Uq.activeItem===Item){Uq.activeItem=null;if(Uq.running)Uq.next();}Item.stop();}};UqItem.progress=function(percent){$(this.el).find('.imce-uqi-percent').text(Drupal.t('!percent%',{'!percent':percent*1})).end().find('.imce-uqi-bar').css('width',percent*1+'%');};imce.eUqInputChange=function(){this.Uq.selectFiles(this.files);imce.uploadResetInput(this);if(imce.getConf('upload_auto_start',1))$('.imce-upload-button',this.form).trigger('click');};imce.eUqItemCancelClick=function(event){var Item=$(this).closest('.imce-uqi')[0].Item;if(Item)Item.remove(true);return false;};imce.eUqItemCancelMousedown=function(event){return false;};imce.eUqItemFadeout=function(){$(this).remove();};imce.xUqItemBeforeSend=function(xhr){};imce.xUqItemXhr=function(){var id=this.itemId;var xhr=new XMLHttpRequest();xhr.upload.onprogress=function(e){var Item=imce.activeUq.getItem(id);if(Item)Item.progress(parseInt(e.loaded*100/e.total));};return xhr;};imce.xUqItemComplete=function(xhr,status){var opt=this;var Item=imce.activeUq.getItem(opt.itemId);status=!!(opt.response&&opt.response.added);if(Item)Item.complete(status);};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.deleteInit=function(){if(imce.hasPermission('delete_files')||imce.hasPermission('delete_subfolders'))imce.addTbb('delete',{title:Drupal.t('Delete'),permission:'delete_files|delete_subfolders',handler:imce.deleteSelection,shortcut:'DEL',icon:'delete'});});imce.deleteSelection=function(){var items=imce.getSelection();if(imce.validateDelete(items))if(confirm(Drupal.formatPlural(items.length,'Delete !filename?','Delete the selected @count items?',{'!filename':items[0].name})))imce.ajaxItems('delete',items);};imce.validateDelete=function(items){return imce.activeFolder.isReady()&&imce.validateCount(items)&&imce.validatePermissions(items,'delete_files','delete_subfolders')&&imce.validatePredefinedPath(items);};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.resizeInit=function(){if(imce.hasPermission('resize_images'))imce.addTbb('resize',{title:Drupal.t('Resize'),permission:'resize_images',content:imce.createResizeForm(),shortcut:'Ctrl+Alt+R',icon:'image'});});imce.createResizeForm=function(){var form=imce.resizeForm;if(!form){form=imce.resizeForm=imce.createEl('<form class="imce-resize-form">'+'<div class="imce-form-item imce-resize-dimensions">'+'<input type="number" name="width" class="imce-resize-width-input" min="1" step="1" />'+'<span class="imce-resize-separator">x</span>'+'<input type="number" name="height" class="imce-resize-height-input" min="1" step="1" />'+'</div>'+'<div class="imce-form-item imce-resize-copy">'+'<label><input type="checkbox" name="copy" class="imce-resize-copy-input" />'+Drupal.t('Create a copy')+'</label>'+'</div>'+'<div class="imce-form-actions">'+'<button type="submit" name="op" class="imce-resize-button">'+Drupal.t('Resize')+'</button>'+'</div>'+'</form>');form.onsubmit=imce.eResizeSubmit;var els=form.elements;els.width.max=imce.getConf('maxwidth')||10000;els.height.max=imce.getConf('maxheight')||10000;els.width.placeholder=Drupal.t('Width');els.height.placeholder=Drupal.t('Height');els.width.onfocus=els.height.onfocus=imce.eResizeInputFocus;}return form;};imce.eResizeSubmit=function(){var data;var els=this.elements;var width=parseInt(els.width.value*1);var height=parseInt(els.height.value*1);var copy=els.copy.checked?1:0;var items=imce.getSelection();if(imce.validateResize(items,width,height,copy)){data={width,height,copy};imce.ajaxItems('resize',items,{data});imce.getTbb('resize').closePopup();}return false;};imce.validateResize=function(items,width,height,copy){return imce.activeFolder.isReady()&&imce.validateCount(items)&&imce.validateImageTypes(items)&&imce.validateDimensions(items,width,height)&&imce.validatePermissions(items,'resize_images');};imce.eResizeInputFocus=function(){var el=this;var val=el.value;setTimeout(function(){if(el===document.activeElement&&val===el.value){var ratio;var els=el.form.elements;var isWidth=els.width===el;var value=els[isWidth?'height':'width'].value*1;var Item=imce.previewingItem;if(Item&&Item.width&&value){ratio=Item.width/Item.height;el.value=Math.round(isWidth?value*ratio:value/ratio);}el=null;}});};})(jQuery,Drupal,imce);;
!function(a,b,c){"use strict";function d(c){if(e=b.documentElement,f=b.body,T(),ha=this,c=c||{},ma=c.constants||{},c.easing)for(var d in c.easing)W[d]=c.easing[d];ta=c.edgeStrategy||"set",ka={beforerender:c.beforerender,render:c.render,keyframe:c.keyframe},la=c.forceHeight!==!1,la&&(Ka=c.scale||1),na=c.mobileDeceleration||y,pa=c.smoothScrolling!==!1,qa=c.smoothScrollingDuration||A,ra={targetTop:ha.getScrollTop()},Sa=(c.mobileCheck||function(){return /Android|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||a.opera);})(),Sa?(ja=b.getElementById(c.skrollrBody||z),ja&&ga(),X(),Ea(e,[s,v],[t])):Ea(e,[s,u],[t]),ha.refresh(),wa(a,"resize orientationchange",function(){var a=e.clientWidth,b=e.clientHeight;(b!==Pa||a!==Oa)&&(Pa=b,Oa=a,Qa=!0);});var g=U();return function h(){$(),va=g(h);}(),ha;}var e,f,g={get:function(){return ha;},init:function(a){return ha||new d(a);},VERSION:"0.6.30"},h=Object.prototype.hasOwnProperty,i=a.Math,j=a.getComputedStyle,k="touchstart",l="touchmove",m="touchcancel",n="touchend",o="skrollable",p=o+"-before",q=o+"-between",r=o+"-after",s="skrollr",t="no-"+s,u=s+"-desktop",v=s+"-mobile",w="linear",x=1e3,y=.004,z="skrollr-body",A=200,B="start",C="end",D="center",E="bottom",F="___skrollable_id",G=/^(?:input|textarea|button|select)$/i,H=/^\s+|\s+$/g,I=/^data(?:-(_\w+))?(?:-?(-?\d*\.?\d+p?))?(?:-?(start|end|top|center|bottom))?(?:-?(top|center|bottom))?$/,J=/\s*(@?[\w\-\[\]]+)\s*:\s*(.+?)\s*(?:;|$)/gi,K=/^(@?[a-z\-]+)\[(\w+)\]$/,L=/-([a-z0-9_])/g,M=function(a,b){return b.toUpperCase();},N=/[\-+]?[\d]*\.?[\d]+/g,O=/\{\?\}/g,P=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g,Q=/[a-z\-]+-gradient/g,R="",S="",T=function(){var a=/^(?:O|Moz|webkit|ms)|(?:-(?:o|moz|webkit|ms)-)/;if(j){var b=j(f,null);for(var c in b)if(R=c.match(a)||+c==c&&b[c].match(a))break;if(!R)return void (R=S="");R=R[0],"-"===R.slice(0,1)?(S=R,R={"-webkit-":"webkit","-moz-":"Moz","-ms-":"ms","-o-":"O"}[R]):S="-"+R.toLowerCase()+"-";}},U=function(){var b=a.requestAnimationFrame||a[R.toLowerCase()+"RequestAnimationFrame"],c=Ha();return (Sa||!b)&&(b=function(b){var d=Ha()-c,e=i.max(0,1e3/60-d);return a.setTimeout(function(){c=Ha(),b();},e);}),b;},V=function(){var b=a.cancelAnimationFrame||a[R.toLowerCase()+"CancelAnimationFrame"];return (Sa||!b)&&(b=function(b){return a.clearTimeout(b);}),b;},W={begin:function(){return 0;},end:function(){return 1;},linear:function(a){return a;},quadratic:function(a){return a*a;},cubic:function(a){return a*a*a;},swing:function(a){return -i.cos(a*i.PI)/2+.5;},sqrt:function(a){return i.sqrt(a);},outCubic:function(a){return i.pow(a-1,3)+1;},bounce:function(a){var b;if(.5083>=a)b=3;else if(.8489>=a)b=9;else if(.96208>=a)b=27;else{if(!(.99981>=a))return 1;b=91;}return 1-i.abs(3*i.cos(a*b*1.028)/b);}};d.prototype.refresh=function(a){var d,e,f=!1;for(a===c?(f=!0,ia=[],Ra=0,a=b.getElementsByTagName("*")):a.length===c&&(a=[a]),d=0,e=a.length;e>d;d++){var g=a[d],h=g,i=[],j=pa,k=ta,l=!1;if(f&&F in g&&delete g[F],g.attributes){for(var m=0,n=g.attributes.length;n>m;m++){var p=g.attributes[m];if("data-anchor-target"!==p.name)if("data-smooth-scrolling"!==p.name)if("data-edge-strategy"!==p.name)if("data-emit-events"!==p.name){var q=p.name.match(I);if(null!==q){var r={props:p.value,element:g,eventType:p.name.replace(L,M)};i.push(r);var s=q[1];s&&(r.constant=s.substr(1));var t=q[2];/p$/.test(t)?(r.isPercentage=!0,r.offset=(0|t.slice(0,-1))/100):r.offset=0|t;var u=q[3],v=q[4]||u;u&&u!==B&&u!==C?(r.mode="relative",r.anchors=[u,v]):(r.mode="absolute",u===C?r.isEnd=!0:r.isPercentage||(r.offset=r.offset*Ka));}}else l=!0;else k=p.value;else j="off"!==p.value;else{if(h=b.querySelector(p.value),null===h)throw 'Unable to find anchor target "'+p.value+'"';}}if(i.length){var w,x,y;!f&&F in g?(y=g[F],w=ia[y].styleAttr,x=ia[y].classAttr):(y=g[F]=Ra++,w=g.style.cssText,x=Da(g)),ia[y]={element:g,styleAttr:w,classAttr:x,anchorTarget:h,keyFrames:i,smoothScrolling:j,edgeStrategy:k,emitEvents:l,lastFrameIndex:-1},Ea(g,[o],[]);}}}for(Aa(),d=0,e=a.length;e>d;d++){var z=ia[a[d][F]];z!==c&&(_(z),ba(z));}return ha;},d.prototype.relativeToAbsolute=function(a,b,c){var d=e.clientHeight,f=a.getBoundingClientRect(),g=f.top,h=f.bottom-f.top;return b===E?g-=d:b===D&&(g-=d/2),c===E?g+=h:c===D&&(g+=h/2),g+=ha.getScrollTop(),g+.5|0;},d.prototype.animateTo=function(a,b){b=b||{};var d=Ha(),e=ha.getScrollTop(),f=b.duration===c?x:b.duration;return oa={startTop:e,topDiff:a-e,targetTop:a,duration:f,startTime:d,endTime:d+f,easing:W[b.easing||w],done:b.done},oa.topDiff||(oa.done&&oa.done.call(ha,!1),oa=c),ha;},d.prototype.stopAnimateTo=function(){oa&&oa.done&&oa.done.call(ha,!0),oa=c;},d.prototype.isAnimatingTo=function(){return !!oa;},d.prototype.isMobile=function(){return Sa;},d.prototype.setScrollTop=function(b,c){return sa=c===!0,Sa?Ta=i.min(i.max(b,0),Ja):a.scrollTo(0,b),ha;},d.prototype.getScrollTop=function(){return Sa?Ta:a.pageYOffset||e.scrollTop||f.scrollTop||0;},d.prototype.getMaxScrollTop=function(){return Ja;},d.prototype.on=function(a,b){return ka[a]=b,ha;},d.prototype.off=function(a){return delete ka[a],ha;},d.prototype.destroy=function(){var a=V();a(va),ya(),Ea(e,[t],[s,u,v]);for(var b=0,d=ia.length;d>b;b++)fa(ia[b].element);e.style.overflow=f.style.overflow="",e.style.height=f.style.height="",ja&&g.setStyle(ja,"transform","none"),ha=c,ja=c,ka=c,la=c,Ja=0,Ka=1,ma=c,na=c,La="down",Ma=-1,Oa=0,Pa=0,Qa=!1,oa=c,pa=c,qa=c,ra=c,sa=c,Ra=0,ta=c,Sa=!1,Ta=0,ua=c;};var X=function(){var d,g,h,j,o,p,q,r,s,t,u,v;wa(e,[k,l,m,n].join(" "),function(a){var e=a.changedTouches[0];for(j=a.target;3===j.nodeType;)j=j.parentNode;switch(o=e.clientY,p=e.clientX,t=a.timeStamp,G.test(j.tagName)||a.preventDefault(),a.type){case k:d&&d.blur(),ha.stopAnimateTo(),d=j,g=q=o,h=p,s=t;break;case l:G.test(j.tagName)&&b.activeElement!==j&&a.preventDefault(),r=o-q,v=t-u,ha.setScrollTop(Ta-r,!0),q=o,u=t;break;default:case m:case n:var f=g-o,w=h-p,x=w*w+f*f;if(49>x){if(!G.test(d.tagName)){d.focus();var y=b.createEvent("MouseEvents");y.initMouseEvent("click",!0,!0,a.view,1,e.screenX,e.screenY,e.clientX,e.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),d.dispatchEvent(y);}return;}d=c;var z=r/v;z=i.max(i.min(z,3),-3);var A=i.abs(z/na),B=z*A+.5*na*A*A,C=ha.getScrollTop()-B,D=0;C>Ja?(D=(Ja-C)/B,C=Ja):0>C&&(D=-C/B,C=0),A*=1-D,ha.animateTo(C+.5|0,{easing:"outCubic",duration:A});}}),a.scrollTo(0,0),e.style.overflow=f.style.overflow="hidden";},Y=function(){var a,b,c,d,f,g,h,j,k,l,m,n=e.clientHeight,o=Ba();for(j=0,k=ia.length;k>j;j++)for(a=ia[j],b=a.element,c=a.anchorTarget,d=a.keyFrames,f=0,g=d.length;g>f;f++)h=d[f],l=h.offset,m=o[h.constant]||0,h.frame=l,h.isPercentage&&(l*=n,h.frame=l),"relative"===h.mode&&(fa(b),h.frame=ha.relativeToAbsolute(c,h.anchors[0],h.anchors[1])-l,fa(b,!0)),h.frame+=m,la&&!h.isEnd&&h.frame>Ja&&(Ja=h.frame);for(Ja=i.max(Ja,Ca()),j=0,k=ia.length;k>j;j++){for(a=ia[j],d=a.keyFrames,f=0,g=d.length;g>f;f++)h=d[f],m=o[h.constant]||0,h.isEnd&&(h.frame=Ja-h.offset+m);a.keyFrames.sort(Ia);}},Z=function(a,b){for(var c=0,d=ia.length;d>c;c++){var e,f,i=ia[c],j=i.element,k=i.smoothScrolling?a:b,l=i.keyFrames,m=l.length,n=l[0],s=l[l.length-1],t=k<n.frame,u=k>s.frame,v=t?n:s,w=i.emitEvents,x=i.lastFrameIndex;if(t||u){if(t&&-1===i.edge||u&&1===i.edge)continue;switch(t?(Ea(j,[p],[r,q]),w&&x>-1&&(za(j,n.eventType,La),i.lastFrameIndex=-1)):(Ea(j,[r],[p,q]),w&&m>x&&(za(j,s.eventType,La),i.lastFrameIndex=m)),i.edge=t?-1:1,i.edgeStrategy){case "reset":fa(j);continue;case "ease":k=v.frame;break;default:case "set":var y=v.props;for(e in y)h.call(y,e)&&(f=ea(y[e].value),0===e.indexOf("@")?j.setAttribute(e.substr(1),f):g.setStyle(j,e,f));continue;}}else 0!==i.edge&&(Ea(j,[o,q],[p,r]),i.edge=0);for(var z=0;m-1>z;z++)if(k>=l[z].frame&&k<=l[z+1].frame){var A=l[z],B=l[z+1];for(e in A.props)if(h.call(A.props,e)){var C=(k-A.frame)/(B.frame-A.frame);C=A.props[e].easing(C),f=da(A.props[e].value,B.props[e].value,C),f=ea(f),0===e.indexOf("@")?j.setAttribute(e.substr(1),f):g.setStyle(j,e,f);}w&&x!==z&&("down"===La?za(j,A.eventType,La):za(j,B.eventType,La),i.lastFrameIndex=z);break;}}},$=function(){Qa&&(Qa=!1,Aa());var a,b,d=ha.getScrollTop(),e=Ha();if(oa)e>=oa.endTime?(d=oa.targetTop,a=oa.done,oa=c):(b=oa.easing((e-oa.startTime)/oa.duration),d=oa.startTop+b*oa.topDiff|0),ha.setScrollTop(d,!0);else{if(!sa){var f=ra.targetTop-d;f&&(ra={startTop:Ma,topDiff:d-Ma,targetTop:d,startTime:Na,endTime:Na+qa}),e<=ra.endTime&&(b=W.sqrt((e-ra.startTime)/qa),d=ra.startTop+b*ra.topDiff|0);}}if(sa||Ma!==d){La=d>Ma?"down":Ma>d?"up":La,sa=!1;var h={curTop:d,lastTop:Ma,maxTop:Ja,direction:La},i=ka.beforerender&&ka.beforerender.call(ha,h);i!==!1&&(Z(d,ha.getScrollTop()),Sa&&ja&&g.setStyle(ja,"transform","translate(0, "+-Ta+"px) "+ua),Ma=d,ka.render&&ka.render.call(ha,h)),a&&a.call(ha,!1);}Na=e;},_=function(a){for(var b=0,c=a.keyFrames.length;c>b;b++){for(var d,e,f,g,h=a.keyFrames[b],i={};null!==(g=J.exec(h.props));)f=g[1],e=g[2],d=f.match(K),null!==d?(f=d[1],d=d[2]):d=w,e=e.indexOf("!")?aa(e):[e.slice(1)],i[f]={value:e,easing:W[d]};h.props=i;}},aa=function(a){var b=[];return P.lastIndex=0,a=a.replace(P,function(a){return a.replace(N,function(a){return a/255*100+"%";});}),S&&(Q.lastIndex=0,a=a.replace(Q,function(a){return S+a;})),a=a.replace(N,function(a){return b.push(+a),"{?}";}),b.unshift(a),b;},ba=function(a){var b,c,d={};for(b=0,c=a.keyFrames.length;c>b;b++)ca(a.keyFrames[b],d);for(d={},b=a.keyFrames.length-1;b>=0;b--)ca(a.keyFrames[b],d);},ca=function(a,b){var c;for(c in b)h.call(a.props,c)||(a.props[c]=b[c]);for(c in a.props)b[c]=a.props[c];},da=function(a,b,c){var d,e=a.length;if(e!==b.length)throw "Can't interpolate between \""+a[0]+'" and "'+b[0]+'"';var f=[a[0]];for(d=1;e>d;d++)f[d]=a[d]+(b[d]-a[d])*c;return f;},ea=function(a){var b=1;return O.lastIndex=0,a[0].replace(O,function(){return a[b++];});},fa=function(a,b){a=[].concat(a);for(var c,d,e=0,f=a.length;f>e;e++)d=a[e],c=ia[d[F]],c&&(b?(d.style.cssText=c.dirtyStyleAttr,Ea(d,c.dirtyClassAttr)):(c.dirtyStyleAttr=d.style.cssText,c.dirtyClassAttr=Da(d),d.style.cssText=c.styleAttr,Ea(d,c.classAttr)));},ga=function(){ua="translateZ(0)",g.setStyle(ja,"transform",ua);var a=j(ja),b=a.getPropertyValue("transform"),c=a.getPropertyValue(S+"transform"),d=b&&"none"!==b||c&&"none"!==c;d||(ua="");};g.setStyle=function(a,b,c){var d=a.style;if(b=b.replace(L,M).replace("-",""),"zIndex"===b)isNaN(c)?d[b]=c:d[b]=""+(0|c);else if("float"===b)d.styleFloat=d.cssFloat=c;else try{R&&(d[R+b.slice(0,1).toUpperCase()+b.slice(1)]=c),d[b]=c;}catch(e){}};var ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa=g.addEvent=function(b,c,d){var e=function(b){return b=b||a.event,b.target||(b.target=b.srcElement),b.preventDefault||(b.preventDefault=function(){b.returnValue=!1,b.defaultPrevented=!0;}),d.call(this,b);};c=c.split(" ");for(var f,g=0,h=c.length;h>g;g++)f=c[g],b.addEventListener?b.addEventListener(f,d,!1):b.attachEvent("on"+f,e),Ua.push({element:b,name:f,listener:d});},xa=g.removeEvent=function(a,b,c){b=b.split(" ");for(var d=0,e=b.length;e>d;d++)a.removeEventListener?a.removeEventListener(b[d],c,!1):a.detachEvent("on"+b[d],c);},ya=function(){for(var a,b=0,c=Ua.length;c>b;b++)a=Ua[b],xa(a.element,a.name,a.listener);Ua=[];},za=function(a,b,c){ka.keyframe&&ka.keyframe.call(ha,a,b,c);},Aa=function(){var a=ha.getScrollTop();Ja=0,la&&!Sa&&(f.style.height=""),Y(),la&&!Sa&&(f.style.height=Ja+e.clientHeight+"px"),Sa?ha.setScrollTop(i.min(ha.getScrollTop(),Ja)):ha.setScrollTop(a,!0),sa=!0;},Ba=function(){var a,b,c=e.clientHeight,d={};for(a in ma)b=ma[a],"function"==typeof b?b=b.call(ha):/p$/.test(b)&&(b=b.slice(0,-1)/100*c),d[a]=b;return d;},Ca=function(){var a,b=0;return ja&&(b=i.max(ja.offsetHeight,ja.scrollHeight)),a=i.max(b,f.scrollHeight,f.offsetHeight,e.scrollHeight,e.offsetHeight,e.clientHeight),a-e.clientHeight;},Da=function(b){var c="className";return a.SVGElement&&b instanceof a.SVGElement&&(b=b[c],c="baseVal"),b[c];},Ea=function(b,d,e){var f="className";if(a.SVGElement&&b instanceof a.SVGElement&&(b=b[f],f="baseVal"),e===c)return void (b[f]=d);for(var g=b[f],h=0,i=e.length;i>h;h++)g=Ga(g).replace(Ga(e[h])," ");g=Fa(g);for(var j=0,k=d.length;k>j;j++)-1===Ga(g).indexOf(Ga(d[j]))&&(g+=" "+d[j]);b[f]=Fa(g);},Fa=function(a){return a.replace(H,"");},Ga=function(a){return " "+a+" ";},Ha=Date.now||function(){return +new Date();},Ia=function(a,b){return a.frame-b.frame;},Ja=0,Ka=1,La="down",Ma=-1,Na=Ha(),Oa=0,Pa=0,Qa=!1,Ra=0,Sa=!1,Ta=0,Ua=[];"function"==typeof define&&define.amd?define([],function(){return g;}):"undefined"!=typeof module&&module.exports?module.exports=g:a.skrollr=g;}(window,document);;
(function($){$.fn.gav_skrollr=function(s){var $w=$(window),loaded,skrollr=this;th=200;this.one("gav_skrollr",function(){s.refresh();});function gav_skrollr(){var inview=skrollr.filter(function(){var $e=$(this);var wt=$w.scrollTop(),wb=wt+$w.height(),et=$e.offset().top,eb=et+$e.height();return eb>=wt-th&&et<=wb+th;});loaded=inview.trigger("gav_skrollr");skrollr=skrollr.not(loaded);}$(window).on("scroll.gav_skrollr",gav_skrollr);};$(window).on('load',function(){setTimeout(function(){s=skrollr.init({forceHeight:!1,smoothScrolling:!1,mobileCheck:function(){return !1;}});if($('.skrollable.refresh').length)$('.skrollable.refresh').gav_skrollr(s);},50);});})(jQuery);;
(function($){var ColorPicker=function(){var ids={},inAction,charMin=65,visible,tpl='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',defaults={eventName:'click',onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:'ff0000',livePreview:true,flat:false},fillRGBFields=function(hsb,cal){var rgb=HSBToRGB(hsb);$(cal).data('colorpicker').fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end();},fillHSBFields=function(hsb,cal){$(cal).data('colorpicker').fields.eq(4).val(hsb.h).end().eq(5).val(hsb.s).end().eq(6).val(hsb.b).end();},fillHexFields=function(hsb,cal){$(cal).data('colorpicker').fields.eq(0).val(HSBToHex(hsb)).end();},setSelector=function(hsb,cal){$(cal).data('colorpicker').selector.css('backgroundColor','#'+HSBToHex({h:hsb.h,s:100,b:100}));$(cal).data('colorpicker').selectorIndic.css({left:parseInt(150*hsb.s/100,10),top:parseInt(150*(100-hsb.b)/100,10)});},setHue=function(hsb,cal){$(cal).data('colorpicker').hue.css('top',parseInt(150-150*hsb.h/360,10));},setCurrentColor=function(hsb,cal){$(cal).data('colorpicker').currentColor.css('backgroundColor','#'+HSBToHex(hsb));},setNewColor=function(hsb,cal){$(cal).data('colorpicker').newColor.css('backgroundColor','#'+HSBToHex(hsb));},keyDown=function(ev){var pressedKey=ev.charCode||ev.keyCode||-1;if((pressedKey>charMin&&pressedKey<=90)||pressedKey==32)return false;var cal=$(this).parent().parent();if(cal.data('colorpicker').livePreview===true)change.apply(this);},change=function(ev){var cal=$(this).parent().parent(),col;if(this.parentNode.className.indexOf('_hex')>0)cal.data('colorpicker').color=col=HexToHSB(fixHex(this.value));else if(this.parentNode.className.indexOf('_hsb')>0)cal.data('colorpicker').color=col=fixHSB({h:parseInt(cal.data('colorpicker').fields.eq(4).val(),10),s:parseInt(cal.data('colorpicker').fields.eq(5).val(),10),b:parseInt(cal.data('colorpicker').fields.eq(6).val(),10)});else cal.data('colorpicker').color=col=RGBToHSB(fixRGB({r:parseInt(cal.data('colorpicker').fields.eq(1).val(),10),g:parseInt(cal.data('colorpicker').fields.eq(2).val(),10),b:parseInt(cal.data('colorpicker').fields.eq(3).val(),10)}));if(ev){fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));}setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data('colorpicker').onChange.apply(cal,[col,HSBToHex(col),HSBToRGB(col)]);},blur=function(ev){var cal=$(this).parent().parent();cal.data('colorpicker').fields.parent().removeClass('colorpicker_focus');},focus=function(){charMin=this.parentNode.className.indexOf('_hex')>0?70:65;$(this).parent().parent().data('colorpicker').fields.parent().removeClass('colorpicker_focus');$(this).parent().addClass('colorpicker_focus');},downIncrement=function(ev){var field=$(this).parent().find('input').focus();var current={el:$(this).parent().addClass('colorpicker_slider'),max:this.parentNode.className.indexOf('_hsb_h')>0?360:(this.parentNode.className.indexOf('_hsb')>0?100:255),y:ev.pageY,field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data('colorpicker').livePreview};$(document).bind('mouseup',current,upIncrement);$(document).bind('mousemove',current,moveIncrement);},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val+ev.pageY-ev.data.y,10))));if(ev.data.preview)change.apply(ev.data.field.get(0),[true]);return false;},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass('colorpicker_slider').find('input').focus();$(document).unbind('mouseup',upIncrement);$(document).unbind('mousemove',moveIncrement);return false;},downHue=function(ev){var current={cal:$(this).parent(),y:$(this).offset().top};current.preview=current.cal.data('colorpicker').livePreview;$(document).bind('mouseup',current,upHue);$(document).bind('mousemove',current,moveHue);},moveHue=function(ev){change.apply(ev.data.cal.data('colorpicker').fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.y))))/150,10)).get(0),[ev.data.preview]);return false;},upHue=function(ev){fillRGBFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));$(document).unbind('mouseup',upHue);$(document).unbind('mousemove',moveHue);return false;},downSelector=function(ev){var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data('colorpicker').livePreview;$(document).bind('mouseup',current,upSelector);$(document).bind('mousemove',current,moveSelector);},moveSelector=function(ev){change.apply(ev.data.cal.data('colorpicker').fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(ev.pageX-ev.data.pos.left))))/150,10)).get(0),[ev.data.preview]);return false;},upSelector=function(ev){fillRGBFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));$(document).unbind('mouseup',upSelector);$(document).unbind('mousemove',moveSelector);return false;},enterSubmit=function(ev){$(this).addClass('colorpicker_focus');},leaveSubmit=function(ev){$(this).removeClass('colorpicker_focus');},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data('colorpicker').color;cal.data('colorpicker').origColor=col;setCurrentColor(col,cal.get(0));cal.data('colorpicker').onSubmit(col,HSBToHex(col),HSBToRGB(col),cal.data('colorpicker').el);},show=function(ev){var cal=$('#'+$(this).data('colorpickerId'));cal.data('colorpicker').onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var viewPort=getViewport();var top=pos.top+this.offsetHeight;var left=pos.left;if(top+176>viewPort.t+viewPort.h)top-=this.offsetHeight+176;if(left+356>viewPort.l+viewPort.w)left-=356;cal.css({left:left+'px',top:top+'px'});if(cal.data('colorpicker').onShow.apply(this,[cal.get(0)])!=false)cal.show();$(document).bind('mousedown',{cal},hide);return false;},hide=function(ev){if(!isChildOf(ev.data.cal.get(0),ev.target,ev.data.cal.get(0))){if(ev.data.cal.data('colorpicker').onHide.apply(this,[ev.data.cal.get(0)])!=false)ev.data.cal.hide();$(document).unbind('mousedown',hide);}},isChildOf=function(parentEl,el,container){if(parentEl==el)return true;if(parentEl.contains)return parentEl.contains(el);if(parentEl.compareDocumentPosition)return !!(parentEl.compareDocumentPosition(el)&16);var prEl=el.parentNode;while(prEl&&prEl!=container){if(prEl==parentEl)return true;prEl=prEl.parentNode;}return false;},getViewport=function(){var m=document.compatMode=='CSS1Compat';return {l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)};},fixHSB=function(hsb){return {h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))};},fixRGB=function(rgb){return {r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))};},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++)o.push('0');o.push(hex);hex=o.join('');}return hex;},HexToRGB=function(hex){var hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return {r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF)};},HexToHSB=function(hex){return RGBToHSB(HexToRGB(hex));},RGBToHSB=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;if(max!=0){}hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0)if(rgb.r==max)hsb.h=(rgb.g-rgb.b)/delta;else if(rgb.g==max)hsb.h=2+(rgb.b-rgb.r)/delta;else hsb.h=4+(rgb.r-rgb.g)/delta;else hsb.h=-1;hsb.h*=60;if(hsb.h<0)hsb.h+=360;hsb.s*=100/255;hsb.b*=100/255;return hsb;},HSBToRGB=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s==0)rgb.r=rgb.g=rgb.b=v;else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3;}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3;}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3;}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3;}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3;}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3;}else{rgb.r=0;rgb.g=0;rgb.b=0;}}return {r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};},RGBToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1)hex[nr]='0'+val;});return hex.join('');},HSBToHex=function(hsb){return RGBToHex(HSBToRGB(hsb));},restoreOriginal=function(){var cal=$(this).parent();var col=cal.data('colorpicker').origColor;cal.data('colorpicker').color=col;fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));};return {init:function(opt){opt=$.extend({},defaults,opt||{});if(typeof opt.color=='string')opt.color=HexToHSB(opt.color);else if(opt.color.r!=undefined&&opt.color.g!=undefined&&opt.color.b!=undefined)opt.color=RGBToHSB(opt.color);else if(opt.color.h!=undefined&&opt.color.s!=undefined&&opt.color.b!=undefined)opt.color=fixHSB(opt.color);else return this;return this.each(function(){if(!$(this).data('colorpickerId')){var options=$.extend({},opt);options.origColor=opt.color;var id='collorpicker_'+parseInt(Math.random()*1000);$(this).data('colorpickerId',id);var cal=$(tpl).attr('id',id);if(options.flat)cal.appendTo(this).show();else cal.appendTo(document.body);options.fields=cal.find('input').bind('keyup',keyDown).bind('change',change).bind('blur',blur).bind('focus',focus);cal.find('span').bind('mousedown',downIncrement).end().find('>div.colorpicker_current_color').bind('click',restoreOriginal);options.selector=cal.find('div.colorpicker_color').bind('mousedown',downSelector);options.selectorIndic=options.selector.find('div div');options.el=this;options.hue=cal.find('div.colorpicker_hue div');cal.find('div.colorpicker_hue').bind('mousedown',downHue);options.newColor=cal.find('div.colorpicker_new_color');options.currentColor=cal.find('div.colorpicker_current_color');cal.data('colorpicker',options);cal.find('div.colorpicker_submit').bind('mouseenter',enterSubmit).bind('mouseleave',leaveSubmit).bind('click',clickSubmit);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat)cal.css({position:'relative',display:'block'});else $(this).bind(options.eventName,show);}});},showPicker:function(){return this.each(function(){if($(this).data('colorpickerId'))show.apply(this);});},hidePicker:function(){return this.each(function(){if($(this).data('colorpickerId'))$('#'+$(this).data('colorpickerId')).hide();});},setColor:function(col){if(typeof col=='string')col=HexToHSB(col);else if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined)col=RGBToHSB(col);else if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined)col=fixHSB(col);else return this;return this.each(function(){if($(this).data('colorpickerId')){var cal=$('#'+$(this).data('colorpickerId'));cal.data('colorpicker').color=col;cal.data('colorpicker').origColor=col;fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setCurrentColor(col,cal.get(0));setNewColor(col,cal.get(0));}});}};}();$.fn.extend({ColorPicker:ColorPicker.init,ColorPickerHide:ColorPicker.hidePicker,ColorPickerShow:ColorPicker.showPicker,ColorPickerSetColor:ColorPicker.setColor});})(jQuery);;
var keyString="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";base64Encode=function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=UTF8Encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h))e=d=64;else{if(isNaN(f))d=64;}a=a+keyString.charAt(j)+keyString.charAt(g)+keyString.charAt(e)+keyString.charAt(d);}return a;};UTF8Encode=function(b){b=b.replace(/\x0d\x0a/g,"\x0a");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128)a+=String.fromCharCode(d);else if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128);}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128);}}return a;};var $customize;if($customize==null)$customize={};(function($){$(document).ready(function(){if($.fn.ColorPicker){$('.colorselector input').each(function(){var $input=$(this);$input.attr('readonly','readonly');$input.ColorPicker({onChange:function(hsb,hex,rgb){$input.parent().find('.input-group-addon').css('backgroundColor','#'+hex);$input.val('#'+hex);}});});$('.colorselector .remove').each(function(){$(this).click(function(){$(this).parent().find('input').val('');$(this).parent().find('.input-group-addon').css('backgroundColor','#eeeeee');});});}$('input#gavias_customize_save').click(function(){saveCustomize();});$('#gavias_customize_preview').click(function(){previewCustomize();});$('#gavias_customize_reset').click(function(){if(drupalSettings.gavias_customize.json){var data=drupalSettings.gavias_customize.json;changeProfile(data);}else{$('#gavias_customize_form .customize-option').each(function(index){$(this).val('');});changeColor();}});if(drupalSettings.gavias_customize.json){var data=drupalSettings.gavias_customize.json;changeProfile(data);}});function changeColor(){$('#gavias_customize_form .colorselector').each(function(){$this=$(this);$(this).find('.input-group-addon').each(function(){$(this).css('background',$this.find('input').val());});});}function dataCustomize(){jQuery('#gavias_customize_form .customize-option').each(function(index){$customize[jQuery(this).attr('name')]=$(this).val();});}function changeProfile(data){var items={};var items=jQuery.parseJSON(data);if(items){$('#gavias_customize_form .customize-option').each(function(index){if(items[$(this).attr('name')])$(this).val(items[$(this).attr('name')]);else $(this).val('');});changeColor();}}function saveCustomize(){dataCustomize();var datacustomize=JSON.stringify($customize);var data={data:datacustomize,theme_name:$('#gva_theme_name').val()};$('#gavias_customize_save').val('Saving...');$.ajax({url:drupalSettings.gavias_customize.save,type:'POST',data,dataType:'Json',success:function(data){$('#gavias_customize_save').val('Save');},error:function(jqXHR,textStatus,errorThrown){alert(textStatus+":"+jqXHR.responseText);}});}function previewCustomize(){dataCustomize();var datacustomize=JSON.stringify($customize);var data={data:datacustomize,theme_name:$('#gva_theme_name').val()};$('#gavias_customize_preview').val('Loading...');$.ajax({url:drupalSettings.gavias_customize.preview,type:'POST',data,dataType:'Json',success:function(data){$('#gavias_customize_preview').val('Preview');$('style.customize').html('');if($('head div#gavias_customize_style').length)$('head div#gavias_customize_style').html(data['style']);else $('head').append('<div id="gavias_customize_style">'+data['style']+'</div>');},error:function(jqXHR,textStatus,errorThrown){alert(textStatus+":"+jqXHR.responseText);}});}})(jQuery);;
